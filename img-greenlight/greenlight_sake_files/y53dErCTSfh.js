if (self.CavalryLogger) { CavalryLogger.start_js(["BUJaV"]); }

__d("MStickersWebDriverIDs",[],(function a(b,c,d,e,f,g){f.exports={STICKER_BUTTON:"MStickersWebDriverIDsStickerButton",STICKER_SELECTOR_CONTENT:"MStickersWebDriverIDsStickerSelectorContent",STICKER_NONSEARCH_PACK_BUTTON:"MStickersWebDriverIDsStickerNonsearchPackButton",STICKER_PACK_ITEM:"MStickersWebDriverIDsStickerPackItem"};}),null);
__d("PUWSteps",[],(function a(b,c,d,e,f,g){f.exports={CLIENT_FLOW_BEGIN:"client_flow_begin",CLIENT_SELECT_BEGIN:"client_select_begin",CLIENT_SELECT_SUCCESS:"client_select_success",CLIENT_SELECT_CANCEL:"client_select_cancel",CLIENT_SELECT_FAIL:"client_select_fail",CLIENT_FLOW_POST:"client_flow_post",CLIENT_TRANSFER_BATCH_BEGIN:"client_transfer_batch_begin",CLIENT_UPLOAD_BEGIN:"client_upload_begin",CLIENT_ATTACH_PHOTO:"client_attach_photo",CLIENT_PROCESS_BEGIN:"client_process_begin",CLIENT_PROCESS_SUCCESS:"client_process_success",CLIENT_PROCESS_CANCEL:"client_process_cancel",CLIENT_PROCESS_SKIP:"client_process_skip",CLIENT_PROCESS_FAIL:"client_process_fail",CLIENT_PROCESS_UNAVAILABLE:"client_process_unavailable",CLIENT_SPHERICAL_CHECK_SUCCESS:"client_spherical_check_success",CLIENT_SPHERICAL_CHECK_FAIL:"client_spherical_check_fail",CLIENT_TRANSFER_ENQUEUE:"client_transfer_enqueue",CLIENT_TRANSFER_BEGIN:"client_transfer_begin",CLIENT_TRANSFER_SUCCESS:"client_transfer_success",CLIENT_TRANSFER_CANCEL:"client_transfer_cancel",CLIENT_TRANSFER_FAIL:"client_transfer_fail",CLIENT_TRANSFER_MANUAL_RETRY:"client_transfer_manual_retry",CLIENT_UPLOAD_SUCCESS:"client_upload_success",CLIENT_UPLOAD_FAIL:"client_upload_fail",CLIENT_UPLOAD_CANCEL:"client_upload_cancel",CLIENT_UPLOAD_REMOVE:"client_upload_remove",CLIENT_FACEREC_BEGIN:"client_facerec_begin",CLIENT_FACEREC_SUCCESS:"client_facerec_success",CLIENT_FACEREC_FAIL:"client_facerec_fail",CLIENT_PHOTO_PREVIEW_OPEN:"client_photo_preview_open",CLIENT_PHOTO_PREVIEW_CLOSE:"client_photo_preview_close",CLIENT_TRANSFER_BATCH_SUCCESS:"client_transfer_batch_success",CLIENT_TRANSFER_BATCH_CANCEL:"client_transfer_batch_cancel",CLIENT_TRANSFER_BATCH_FAIL:"client_transfer_batch_fail",CLIENT_PUBLISH_ENQUEUE:"client_publish_enqueue",CLIENT_PUBLISH_BEGIN:"client_publish_begin",CLIENT_PUBLISH_SUCCESS:"client_publish_success",CLIENT_PUBLISH_FAIL:"client_publish_fail",CLIENT_ATTEMPT_FAIL:"client_attempt_fail",CLIENT_FLOW_SUCCESS:"client_flow_success",CLIENT_FLOW_FATAL:"client_flow_fatal",CLIENT_FLOW_GIVEUP:"client_flow_giveup",CLIENT_FLOW_CANCEL:"client_flow_cancel",CLIENT_FLOW_FAIL:"client_flow_fail",CLIENT_FLOW_INCOMPLETE:"client_flow_incomplete",CLIENT_ATTEMPT_INCOMPLETE:"client_attempt_incomplete",CLIENT_FLOW_RETRY:"client_flow_retry",CLIENT_ATTEMPT_RETRY:"client_attempt_retry",CLIENT_DIAGNOSTIC:"client_diagnostic",CLIENT_QUALITY_SWITCH:"client_quality_switch",CLIENT_CANCEL_SURVEY:"client_cancel_survey",CLIENT_PHOTO_EDIT_BEGIN:"client_photo_edit_begin",CLIENT_PHOTO_EDIT_SUCCESS:"client_photo_edit_success",SERVER_UPLOAD_BEGIN:"server_upload_begin",SERVER_UPLOAD_SUCCESS:"server_upload_success",SERVER_UPLOAD_FAIL:"server_upload_fail",SERVER_PUBLISH_BEGIN:"server_publish_begin",SERVER_PUBLISH_SUCCESS:"server_publish_success",SERVER_PUBLISH_FAIL:"server_publish_fail",SERVER_RECEIVER_BEGIN:"server_receiver_begin",SERVER_RECEIVER_PUBLISH_BEGIN:"server_receiver_publish_begin",SERVER_SENTRY_RESTRICTION:"server_sentry_restriction"};}),null);
__d("StickerInterfaces",[],(function a(b,c,d,e,f,g){f.exports={MESSAGES:"messages",COMMENTS:"comments",STICKERED:"stickered",COMPOSER:"composer",POSTS:"posts",FRAMES:"frames",SMS:"sms",MONTAGE:"montage"};}),null);
__d('MCommentStatusLogger',['BanzaiLogger','ex','uuid'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k={INIT:'init',SUBMIT:'submit',RESPOND:'respond',RENDER:'render'};function l(q,r,s){this.prevEventType=q||null;this.perfLoggable=!!r;this.isEndStep=!!s;}var m={};m[k.INIT]=new l();m[k.SUBMIT]=new l(k.INIT,true);m[k.RESPOND]=new l(k.SUBMIT,true);m[k.RENDER]=new l(k.RESPOND,true,true);function n(q){this.$InteractionLog1=q;this.$InteractionLog2={};this.$InteractionLog3=0;this.$InteractionLog4=0;this.$InteractionLog5=null;}n.prototype.$InteractionLog6=function(q){return q in this.$InteractionLog2;};n.prototype.logEvent=function(q,r){if(this.$InteractionLog6(q)||!(q in m))return false;var s=m[q],t=s.prevEventType;if(t&&!this.$InteractionLog6(t))return false;this.$InteractionLog3=r&&Object.prototype.hasOwnProperty.call(r,'text')?r.text:this.$InteractionLog3;this.$InteractionLog4=r&&Object.prototype.hasOwnProperty.call(r,'photo')?r.photo:this.$InteractionLog4;this.$InteractionLog5=(r&&Object.prototype.hasOwnProperty.call(r,'stickerID')?r.stickerID:this.$InteractionLog5)||null;var u=Date.now(),v=Math.round(u/1000);this.$InteractionLog2[q]=u;var w={event:q,text_length:this.$InteractionLog3,num_photos:this.$InteractionLog4,sticker_id:this.$InteractionLog5,interaction_key:this.$InteractionLog1,client_time:v};if(t&&s.perfLoggable){var x=this.$InteractionLog7(t,q);w=babelHelpers['extends']({duration:x},w);}h.create({retry:true}).log('MCommentWriteWaterfallLoggerConfig',w);return true;};n.prototype.$InteractionLog7=function(q,r){var s=this.$InteractionLog2;if(!this.$InteractionLog6(q)||!this.$InteractionLog6(r))return null;var t=s[q],u=s[r];if(t>u)return null;return u-t;};var o={},p={newInteractionKey:function q(){return j();},_logCommentStatus:function q(r,s,t){if(!(s in m))return;var u=o[r];if(s===k.INIT)if(u){return;}else{u=new n(r);o[r]=u;}if(!u)return;var v=u.logEvent(s,t);if(v&&m[s].isEndStep)this.clear(r);},logInitText:function q(r){this._logCommentStatus(r,k.INIT,{text:1});},logInitPhoto:function q(r){this._logCommentStatus(r,k.INIT,{photo:1});},logSubmit:function q(r,s){this._logCommentStatus(r,k.SUBMIT,{text:s.text,photo:s.photo,stickerID:null});},logReceiveResponse:function q(r,s){this._logCommentStatus(r,k.RESPOND,{text:s.text,photo:s.photo,stickerID:s.stickerID});},logRender:function q(r){this._logCommentStatus(r,k.RENDER);},logInitAndSubmitSticker:function q(r,s){this._logCommentStatus(r,k.INIT,{text:0,photo:0,stickerID:s});this._logCommentStatus(r,k.SUBMIT,{text:0,photo:0,stickerID:s});},clear:function q(r){if(r in o)delete o[r];}};f.exports=p;}),null);
__d('MLoadingIndicator.react',['IndicatorType','MJSAnimator','MJSEnvironment','React','ReactDOM','cx'],(function a(b,c,d,e,f,g,h,i,j,k,l,m){var n,o,p=k.PropTypes,q=j.IS_APPLE_WEBKIT_IOS,r=j.IS_ANDROID&&j.OS_VERSION<4;n=babelHelpers.inherits(s,k.Component);o=n&&n.prototype;function s(){var t,u;'use strict';for(var v=arguments.length,w=Array(v),x=0;x<v;x++)w[x]=arguments[x];return u=(t=o.constructor).call.apply(t,[this].concat(w)),this.getClassName=function(){return (this.props.className||'')+' '+((!r?"_55on":'')+(' '+"_2so")+(this.props.background==='dark'?' '+"_2st":'')+(this.props.background==='light'?' '+"_2ss":'')+(this.props.size==='large'?' '+"_2sq":'')+(this.props.size==='small'?' '+"_2sp":'')+(!r&&!q?' '+"_50cg":'')+(q?' '+"_50ch":'')+(r?' '+"_2su":''));}.bind(this),this.renderGradientIfNeeded=function(){if(r||!q)return null;return k.createElement('div',{className:"_2sr _55on"});},u;}s.prototype.componentDidMount=function(){'use strict';if(r){this.$MLoadingIndicator1=new i(l.findDOMNode(this.refs.spinner),h.ANDROID_NONROTATING,false);this.$MLoadingIndicator1.start();}};s.prototype.componentWillUnmount=function(){'use strict';if(this.$MLoadingIndicator1){this.$MLoadingIndicator1.cleanup();this.$MLoadingIndicator1=null;}};s.prototype.render=function(){'use strict';return k.createElement('div',{ref:'spinner',className:this.getClassName()},this.renderGradientIfNeeded());};s.propTypes={background:p.oneOf(['light','dark']),size:p.oneOf(['small','large'])};s.defaultProps={background:'light',size:'large'};f.exports=s;}),null);
__d('MProgressBar.react',['MAnimator','React','joinClasses','cx'],(function a(b,c,d,e,f,g,h,i,j,k){var l=i.PropTypes,m=i.createClass({displayName:'MProgressBar',propTypes:{initialValue:l.number.isRequired,min:l.number,max:l.number},getDefaultProps:function n(){return {min:0,max:100};},getInitialState:function n(){return {value:this.props.initialValue};},componentWillUnmount:function n(){this._animator&&this._animator.dispose();},_calculatePercentage:function n(o){var p=this.props,q=Math.min(Math.max((o-p.min)/(p.max-p.min)*100,0),100);return q;},_getFillArea:function n(){var o=this._calculatePercentage(this.state.value),p=Math.round(o),q="fill"+(p===0?' '+"empty":'')+(p===100?' '+"full":'');return i.createElement('div',{className:q,style:{width:o+'%'}});},animate:function n(o,p){var q=this._calculatePercentage(this.state.value),r=this._calculatePercentage(o);this._animator&&this._animator.dispose();this._animator=h.play(q,r,p,this.setValue);},setValue:function n(o){if(this.isMounted())this.setState({value:o});},render:function n(){return i.createElement('div',{className:j(this.props.className,"_lbu")},this._getFillArea());}});f.exports=m;}),null);
__d('Grid.react',['React','cx','joinClasses'],(function a(b,c,d,e,f,g,h,i,j){var k,l,m,n,o=h.PropTypes;k=babelHelpers.inherits(p,h.Component);l=k&&k.prototype;p.prototype.render=function(){'use strict';var r=this.props,s=r.alignh,t=r.alignv,u=r.children,v=r.cols,w=r.fixed,x=r.spacing,y=h.Children.count(u),z=[],aa=[],ba=0;h.Children.forEach(u,function(ca,da){if(ca===null||ca===undefined)return;var ea=ca.type===q;ba+=ea?Math.max(ca.props.colSpan||0,1):1;var fa=ba===v?"_51mw":'';if(!ea){ca=h.createElement(q,{alignh:s,alignv:t,className:j(x,fa),key:ca.key||da},ca);}else ca=h.cloneElement(ca,{key:ca.key||da,alignh:ca.props.alignh||s,alignv:ca.props.alignv||t,className:j(ca.props.className,x,fa)});aa.push(ca);if(ba%v===0||da+1===y){if(w&&ba<v){for(var ga=ba;ga<v;ga++)aa.push(h.createElement(q,{key:da+ga}));ba=v;}z.push(h.createElement('tr',{className:"_51mx",key:da},aa));aa=[];ba=0;}});return h.createElement('table',babelHelpers['extends']({},this.props,{className:j(this.props.className,"uiGrid"+(' '+"_51mz")+(w?' '+"_5f0n":'')),cellSpacing:'0',cellPadding:'0'}),h.createElement('tbody',null,z));};function p(){'use strict';k.apply(this,arguments);}p.propTypes={cols:o.number.isRequired,fixed:o.bool,alignv:o.oneOf(['top','middle','bottom']),alignh:o.oneOf(['left','center','right']),spacing:o.string};m=babelHelpers.inherits(q,h.Component);n=m&&m.prototype;q.prototype.render=function(){'use strict';var r=this.props,s=r.alignh,t=r.alignv,u=r.className,v=babelHelpers.objectWithoutProperties(r,['alignh','alignv','className']),w=j(u,"_51m-"+(t==='top'?' '+"vTop":'')+(t==='middle'?' '+"vMid":'')+(t==='bottom'?' '+"vBot":'')+(s==='left'?' '+"hLeft":'')+(s==='center'?' '+"hCent":'')+(s==='right'?' '+"hRght":''));return h.createElement('td',babelHelpers['extends']({},v,{className:w}));};function q(){'use strict';m.apply(this,arguments);}q.propTypes={alignv:o.oneOf(['top','middle','bottom']),alignh:o.oneOf(['left','center','right']),className:o.string};p.GridItem=q;f.exports=p;}),null);
__d("XStickerPackImagesController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/stickers\/{pack_id}\/images\/",{pack_id:{type:"Int",required:true},sticker_size:{type:"Int",defaultValue:50}});}),null);
__d("XStickerQueryImagesController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/stickers\/query\/images\/",{query:{type:"String",required:true},sticker_interface:{type:"String"}});}),null);
__d('MStickerPack.react',['Grid.react','MRequest','MStickersInitialData','MStickersWebDriverIDs','MURI','React','Image.react','ReactComponentWithPureRenderMixin','ShimButton.react','StickerInterfaces','XStickerPackImagesController','XStickerQueryImagesController','cx','ix','fbt','debounceCore'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){'use strict';var x=h.GridItem,y=j.MRU_STICKER_PACK,z=14,aa={},ba=m.createClass({displayName:'MStickerPack',mixins:[o],getInitialState:function ca(){return {input:'',loading:false,searching:false,stickers:[]};},getDefaultProps:function ca(){return {isComments:false};},componentWillMount:function ca(){this._debouncedGetStickersForQuery=w(this.getStickersForQuery,500);this.getStickers(this.props.pack.id);},componentWillReceiveProps:function ca(da){this.getStickers(da.pack.id);},componentWillUnmount:function ca(){this._debouncedGetStickersForQuery.reset();},updateRecentlyUsed:function ca(da){var ea=aa[y]||[];for(var fa=0;fa<ea.length;++fa)if(ea[fa].id===da.id){ea.splice(fa,1);break;}ea.unshift(da);if(!aa[y]){aa[y]=ea;j.packs.unshift(j.mru);}},getStickers:function ca(da){if(!da||da==j.SEARCH_PACK)return;if(da in aa){this.setState({input:'',loading:false,stickers:aa[da],searching:false});return;}var ea=r.getURIBuilder().setInt('pack_id',da).getURI(),fa=new i(new l(ea));fa.listen('done',function(ga){aa[da]=ga.payload;this.isMounted()&&this.setState({input:'',loading:false,stickers:ga.payload,searching:false});}.bind(this));this.setState({loading:true});fa.send();},getStickersForQuery:function ca(da,ea){if(da.length===0){this.setState({loading:false,searching:false});return;}if(da!=this.state.input&&!ea)return;var fa=s.getURIBuilder().setString('query',da).setString('sticker_interface',this.props.isComments?q.COMMENTS:q.MESSAGES).getURI(),ga=new i(new l(fa));ga.listen('done',function(ha){var ia=ha.payload||[];if(this.isMounted()&&da==this.state.input)this.setState({loading:false,stickers:ia,searching:true});}.bind(this));this.setState({loading:true});ga.send();},selectSticker:function ca(da){this.updateRecentlyUsed(da);this.props.onSelect&&this.props.onSelect(da.id);},renderSticker:function ca(da,ea){var fa=null;if(this.props.isComments&&!da.isCommentsCapable){if(this.props.pack.id==j.MRU_STICKER_PACK)return;}else if(!this.props.isComments&&!da.isMessengerCapable){if(this.props.pack.id==j.MRU_STICKER_PACK)return;}else fa=this.selectSticker.bind(this,da);return m.createElement('a',{className:"_5asg",'data-testid':k.STICKER_PACK_ITEM,href:'#',key:'sticker-'+ea,onClick:fa,role:'button'},m.createElement(n,{src:da.uri,alt:v._("{pack name} {sticker name} sticker",[v.param('pack name',da.packName),v.param('sticker name',da.accessibilityLabel)])}));},_getRenderedFakeStickers:function ca(){return Array.from(new Array(z),function(da,ea){return m.createElement('div',{key:'fake-'+ea,className:"_u2_"});});},_getRenderedStickerGridItems:function ca(){return this.state.stickers.map(this.renderSticker).concat(this._getRenderedFakeStickers());},render:function ca(){if(this.props.pack.id==j.SEARCH_PACK)return m.createElement('div',{className:"_5ash"},m.createElement('div',{className:"_5ef_"},this._renderSearch(),this._renderTags(),this._renderStickerSearchResults()),this._renderLoading());if(this.state.loading)return m.createElement('div',{className:"_5ash"},this._renderLoading());return m.createElement('div',{className:"_5ash"+(this.props.isComments&&!this.props.pack.isCommentsCapable?' '+"_5jkg":''),onScroll:this.props.onScroll},m.createElement('div',{className:"_5ef_",onScroll:this._onScroll},this._getRenderedStickerGridItems()),this.renderMask());},_renderLoading:function ca(){if(!this.state.loading)return null;return m.createElement('span',{className:"_5asi"},v._("Loading..."));},_renderStickerSearchResults:function ca(){if(!this.state.searching||this.state.loading)return null;if(this.state.stickers.length===0)return m.createElement('div',{className:"_4op9"},m.createElement(n,{src:u("87146")}),m.createElement('p',null,v._("No Stickers to Show")));return m.createElement('div',{className:"_5ash"+(this.props.isComments&&!this.props.pack.isCommentsCapable?' '+"_5jkg":''),onScroll:this.props.onScroll},m.createElement('div',{className:"_5ef_"},this._getRenderedStickerGridItems()),this.renderMask());},renderMask:function ca(){if(!(this.props.isComments&&!this.props.pack.isCommentsCapable))return null;return m.createElement('div',{className:"_5jkh"},m.createElement('div',{className:"_5jki"},v._("This pack is only available in messages")));},_renderSearch:function ca(){return m.createElement('div',{className:"_2j-l"},m.createElement('span',{className:"_2j-m"}),this._renderCloseButton(),m.createElement('div',{className:"_4opa"},m.createElement('input',{className:"_2j-n",onChange:this._inputChanged,onFocus:this.props.onInputFocus,onBlur:this.props.onInputBlur,ref:'stickerQuery',value:this.state.input,placeholder:v._("Search stickers"),type:'text'})));},_renderCloseButton:function ca(){if(this.state.input.length>0)return m.createElement(p,{className:"_4opb",inline:true,onClick:this._clearInput});},_renderTags:function ca(){if(this.state.searching||this.state.loading)return null;var da=j.tags.filter(function(ea){return ea.sourceURI!==null;}).sort(function(ea,fa){return ea.order-fa.order;}).map(function(ea,fa){return m.createElement(x,{className:"_2j-o",key:fa},m.createElement('div',{className:"_2j-p"},m.createElement(p,{className:"_2j-q",onClick:this._selectTag.bind(this,ea),style:{background:'#'+ea.color_code}},m.createElement(n,{src:ea.sourceURI}),m.createElement('span',null,ea.name))));}.bind(this));return m.createElement(h,{className:"_2j-r",cols:2,fixed:true,ref:'grid'},da);},_inputChanged:function ca(event){this.setState({input:event.target.value});this._debouncedGetStickersForQuery(event.target.value,false);},_clearInput:function ca(){this.setState({input:'',loading:false,searching:false});},_selectTag:function ca(da){this.setState({input:da.name});this.getStickersForQuery(da.name,true);}});f.exports=ba;}),null);
__d('MStickerPackButton.react',['Image.react','MStickersInitialData','MStickersWebDriverIDs','React','ShimButton.react','cx'],(function a(b,c,d,e,f,g,h,i,j,k,l,m){var n,o;n=babelHelpers.inherits(p,k.PureComponent);o=n&&n.prototype;function p(){var q,r;'use strict';for(var s=arguments.length,t=Array(s),u=0;u<s;u++)t[u]=arguments[u];return r=(q=o.constructor).call.apply(q,[this].concat(t)),this.onClick=function(){this.props.onclick&&this.props.onclick(this.props.pack);}.bind(this),r;}p.prototype.render=function(){'use strict';var q="_5arz"+(' '+"_5cni")+(this.props.selected?' '+"_5ar-":'')+(this.props.disabled?' '+"_4f39":''),r=this.props.pack,s;if(r.id==i.MRU_STICKER_PACK){s=k.createElement('span',{className:"_3rsg"});}else if(r.id==i.SEARCH_PACK){s=k.createElement('span',{className:"_cmr"});}else s=k.createElement(h,{src:r.icon,alt:r.name});var t=r.id==i.SEARCH_PACK?null:j.STICKER_NONSEARCH_PACK_BUTTON;return k.createElement(l,{className:q,'data-testid':t,form:'link',onClick:this.onClick,rel:'ignore'},s);};f.exports=p;}),null);
__d("XStickerStorePermalinkController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/stickers\/",{tab:{type:"String"},redirect_uri:{type:"String"},is_comments:{type:"Bool",defaultValue:false}});}),null);
__d('MStickerSelector.react',['BanzaiLogger','DOM','MPageController','MParent','MStickerPack.react','MStickerPackButton.react','MStickersInitialData','MStickersWebDriverIDs','MViewport','React','ReactDOM','Stratcom','SubscriptionsHandler','UserAgent','XStickerStorePermalinkController','getActiveElement','cx','fbt'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){var z,aa,ba=q.PropTypes,ca='feed-ufi-comments',da='scroll-area';z=babelHelpers.inherits(ea,q.Component);aa=z&&z.prototype;function ea(ga){'use strict';aa.constructor.call(this,ga);fa.call(this);var ha=null;if(n.packs&&n.packs.length)for(var ia=0;ia<n.packs.length;ia++)if(!ga.isComments&&n.packs[ia].isMessengerCapable||ga.isComments&&n.packs[ia].isCommentsCapable){ha=n.packs[ia];break;}this.state={selectedPack:ha,prevDisabled:true,nextDisabled:false,scrollLeft:0};}ea.prototype.render=function(){'use strict';if(!this.props.isOpen)return null;var ga=n.packs.length===0?q.createElement('div',{className:"_5ar_"},y._("No stickers available")):q.createElement(l,{pack:this.state.selectedPack,onSelect:this.props.callback,onScroll:this.onPackScroll,onInputFocus:this.onInputFocus,onInputBlur:this.onInputBlur,isComments:this.props.isComments}),ha=n.packs,ia=[];for(var ja=0;ja<ha.length;ja++)if(ha[ja])if(this.props.isComments&&ha[ja].isCommentsCapable){ia.push(ha[ja]);}else if(ha[ja].isMessengerCapable)ia.push(ha[ja]);ha=ia;ha=ha.map(this.renderPack,this);var ka=v.getURIBuilder().setString('redirect_uri',j.getRenderedPath()).setBool('is_comments',this.props.isComments).getURI(),la=null;if(this.props.showStore)la=q.createElement('a',{className:"_5cni _5b3_",href:ka.toString()},q.createElement('span',{className:"_5b40"}),this.renderIndicator());var ma=u.isPlatform('Android <2.4');return q.createElement('div',{className:this.props.className,'data-testid':o.STICKER_SELECTOR_CONTENT,ref:'root'},q.createElement('div',{className:"_5as0"+(ma?' '+"_2-n8":''),ref:'selector'},q.createElement('div',{className:"_5as1",onScroll:this.state.inputFocused?this.$MStickerSelector4:null},ga),q.createElement('div',{className:"_5as2",ref:'selectorRow',style:{marginLeft:-this.state.scrollLeft}},q.createElement('div',{className:"_5as5"},ha)),this.$MStickerSelector5(),this.$MStickerSelector6(),la));};ea.prototype.componentDidMount=function(){'use strict';if(this.props.isOpen){this.$MStickerSelector8();this.$MStickerSelector7();}};ea.prototype.componentWillUnmount=function(){'use strict';this.$MStickerSelector9();};ea.prototype.componentDidUpdate=function(ga,ha){'use strict';if(this.props.isOpen){if(!ga.isOpen)this.$MStickerSelector8();if(this.state.selectedPack!=ha.selectedPack||this.props.isOpen!=ga.isOpen){var ia=r.findDOMNode(this.refs.selector);if(k.bySigil(ia,ca)){s.invoke('MStickerSelector:show-sticker-selector',null,{selectorNode:ia});}else p.scrollToNodeIfNecessary(r.findDOMNode(this.refs.selector));}if(this.props.isOpen!=ga.isOpen){this.$MStickerSelector7();h.log('MTouchStickersLoggerConfig',{event:'open_tray'});}}else if(ga.isOpen)this.$MStickerSelector9();};ea.propTypes={callback:ba.func.isRequired,isComments:ba.bool.isRequired,isOpen:ba.bool,onClose:ba.func,showStore:ba.bool.isRequired};ea.defaultProps={isComments:true,showStore:true};var fa=function ga(){this.$MStickerSelector1=null;this.onPackSelect=function(ha){h.log('MTouchStickersLoggerConfig',{event:'select_pack',packid:ha.id});this.setState({selectedPack:ha});}.bind(this);this.onPackScroll=function(){if(this.state.selectedPack&&this.state.selectedPack.id!=this.$MStickerSelector2){this.$MStickerSelector2=this.state.selectedPack.id;h.log('MTouchStickersLoggerConfig',{event:'scroll_pack',packid:this.state.selectedPack.id});}}.bind(this);this.onInputFocus=function(){this.setState({inputFocused:true});}.bind(this);this.onInputBlur=function(){this.setState({inputFocused:false});}.bind(this);this.scrollPrev=function(){if(!this.state.prevDisabled){var ha=Math.max(this.state.scrollLeft-200,0);this.setState({scrollLeft:ha,prevDisabled:ha===0,nextDisabled:false});}}.bind(this);this.scrollNext=function(){if(!this.state.nextDisabled){var ha=r.findDOMNode(this.refs.selectorRow),ia=ha.scrollWidth-ha.parentNode.clientWidth,ja=Math.min(this.state.scrollLeft+200,ia);this.setState({scrollLeft:ja,prevDisabled:false,nextDisabled:this.$MStickerSelector3(ja)});}}.bind(this);this.$MStickerSelector3=function(ha){var ia=r.findDOMNode(this.refs.selectorRow),ja=ia.scrollWidth-ia.parentNode.clientWidth;return ha>=ja;}.bind(this);this.renderPack=function(ha,ia){return q.createElement(m,{disabled:this.props.isComments&&!ha.isCommentsCapable||!this.props.isComments&&!ha.isMessengerCapable,key:'pack-'+ia,onclick:this.onPackSelect,pack:ha,selected:ha.id==this.state.selectedPack.id});}.bind(this);this.renderIndicator=function(){if(!n.storeIndicator)return null;return q.createElement('div',{className:"_5e-s"});};this.$MStickerSelector5=function(){return q.createElement('a',{'aria-label':y._("Previous Sticker Packs"),className:"_5cni _5abu",disabled:this.state.prevDisabled,href:'#',onClick:this.scrollPrev,ref:'prevButton',rel:'ignore',role:'button'},q.createElement('span',{className:"_5abw"}));}.bind(this);this.$MStickerSelector6=function(){return q.createElement('a',{'aria-label':y._("Next Sticker Packs"),className:"_5cni _5abx",disabled:this.state.nextDisabled,href:'#',onClick:this.scrollNext,ref:'nextButton',rel:'ignore',role:'button'},q.createElement('span',{className:"_5aby"}));}.bind(this);this.$MStickerSelector7=function(){this.setState({nextDisabled:this.$MStickerSelector3(this.state.scrollLeft)});}.bind(this);this.$MStickerSelector4=function(event){w().blur();};this.$MStickerSelector8=function(){if(this.$MStickerSelector1)return;var ha=r.findDOMNode(this.refs.root);if(!ha)return;if(k.bySigil(ha,da)){var ia=new t();ia.addSubscriptions(i.listen(ha,'touchmove',null,function(event){event.stop();}),s.listen('m:page:unload',null,function(){this.$MStickerSelector9();}.bind(this)));if(k.bySigil(ha,ca))ia.addSubscriptions(s.listen('m:feed-ufi-flyout:reset',null,function(){this.$MStickerSelector9();}.bind(this)));this.$MStickerSelector1=ia;}}.bind(this);this.$MStickerSelector9=function(){this.$MStickerSelector1&&this.$MStickerSelector1.release();this.$MStickerSelector1=null;}.bind(this);};f.exports=ea;}),null);
__d('MStickerSelectorButton.react',['Image.react','React','cx','fbt','ix','fbglyph'],(function a(b,c,d,e,f,g,h,i,j,k,l,m){var n,o,p=i.PropTypes;n=babelHelpers.inherits(q,i.Component);o=n&&n.prototype;function q(){var r,s;'use strict';for(var t=arguments.length,u=Array(t),v=0;v<t;v++)u[v]=arguments[v];return s=(r=o.constructor).call.apply(r,[this].concat(u)),this.state={isSelected:this.props.isSelected},this.onClick=function(event){this.setState({isSelected:!this.state.isSelected});this.props.onClick&&this.props.onClick(event);}.bind(this),s;}q.prototype.componentWillUpdate=function(r,s){'use strict';if(r!==this.props)this.setState({isSelected:r.isSelected});if(this.props.onToggle&&s!==this.state)this.props.onToggle(s.isSelected);};q.prototype.render=function(){'use strict';var r;if(!this.state.isSelected){r=l("90727");}else r=l("90728");return i.createElement('button',{'aria-label':k._("Add Sticker"),type:'button',className:"_5ecn _1n29 _2fv6",'data-sigil':'touchable',onClick:this.onClick},i.createElement(h,{src:r,className:"_2fv7"}),i.createElement(h,{src:l("124496"),className:"_2fv8"}));};q.propTypes={onToggle:p.func,isSelected:p.bool};q.defaultProps={isSelected:false};f.exports=q;}),null);
__d('MStickerMount',['ClientIDs','DOM','MAjaxify','MCommentStatusLogger','MRequest','MStickerSelector.react','MStickerSelectorButton.react','ReactComponentRenderer','Run','Stratcom','SubscriptionsHandler','$'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){'use strict';var t='m-textarea-input',u=function y(z,aa,ba,ca){var da=new l(z.action);da.setMethod('POST');da.addData({client_id:h.getNewClientID(),sticker_id:aa});if(ba){var ea=k.newInteractionKey();k.logInitAndSubmitSticker(ea,aa);da.addData({logging_interaction_key:ea});w(ea);}j.ajaxify(null,z,da,'async_composer');q.invoke('m:ufi:sticker-comment',null,{textInput:ca});},v=function y(z,aa,ba,ca,da,ea){var fa=void 0,ga=new o(m,aa);ga.setProps({callback:ca,isComments:da,onClose:function ia(){ga&&ga.setProps({isOpen:false});fa&&fa.setProps({isSelected:false});},showStore:ea});fa=new o(n,z);fa.setProps({onToggle:function ia(ja){ga.setProps({isOpen:ja});}});var ha=new r();ha.addSubscriptions(i.listen(ba,'focus',null,function(){fa.setProps({isSelected:false});}),q.listen('m:ufi:sticker-comment',null,function(){fa.setProps({isSelected:false});}));p.onLeave(function(){ha.release();fa.unmount();ga.unmount();});};function w(y){var z=new r();z.addSubscriptions(q.listen('m:ufi:live-comments:render',null,function(event){var aa=event.getData()||{},ba=aa.logKeys;ba&&ba.forEach(function(ca){if(ca===y){k.logRender(y);z.release();}});}),q.listen('m:ufi:iui:comment-added',null,function(event){var aa=event.getData().loggingInteractionKey;if(aa===y){k.logRender(y);z.release();}}),q.listen('m:page:unload',null,function(){z.release();}));return z;}var x={initMessages:function y(z,aa,ba,ca){var da=s(ba),ea=function fa(ga){var ha=da.form,ia=i.convertFormToDictionary(ha);ia.sticker_id=ga;ca.sendRequest(ha.action,ia);};v(z,aa,da,ea,false,true);},initCommentsFlyout:function y(z,aa,ba,ca){var da=arguments.length<=4||arguments[4]===undefined?false:arguments[4],ea=null;if(ca)if(q.hasSigil(ca,t)){ea=ca;}else ea=i.scry(ca,'*',t)[0];if(!ea)ea=s(ba);var fa=ea.form;aa.onclick=function(){u(fa,z,da,ea);};},initComments:function y(z,aa,ba,ca){var da=arguments.length<=4||arguments[4]===undefined?false:arguments[4],ea=null;if(ca)if(q.hasSigil(ca,t)){ea=ca;}else ea=i.scry(ca,'*',t)[0];if(!ea)ea=s(ba);var fa=ea.form,ga=function ha(ia){u(fa,ia,da,ea);};v(z,aa,ea,ga,true,true);},initNewMessage:function y(z,aa,ba,ca){var da=function ea(fa){ca.sendSticker(fa);};v(z,aa,ba,da,false,false);}};f.exports=x;}),null);
__d('MMultiPhotoUploaderAttachment.react',['MMultiPhotoUploaderAttachmentState','MLoadingIndicator.react','MProgressBar.react','React','Image.react','ShimButton.react','cx','fbt','joinClasses'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q,r,s=2,t=.7,u=500,v=10000,w=250;q=babelHelpers.inherits(x,k.Component);r=q&&q.prototype;function x(){var y,z;'use strict';for(var aa=arguments.length,ba=Array(aa),ca=0;ca<aa;ca++)ba[ca]=arguments[ca];return z=(y=r.constructor).call.apply(y,[this].concat(ba)),this.$Attachment1=false,this.$Attachment2=0,this.state={previewLoaded:false},this.getLoadingIndicator=function(){if(this.props.loaded>0){if(!this.state.previewLoaded){return this.getProgressBar();}else return this.getSpinner();}else return this.getSpinner();}.bind(this),this.getProgressBar=function(){if(this.props.state!==h.SENDING&&this.props.state!==h.UPLOADED)return null;if(this.state.previewLoaded)return null;return k.createElement('div',{className:"_r6h"},k.createElement(j,{initialValue:0,ref:'progressBar'}));}.bind(this),this.getSpinner=function(){if(this.props.state!==h.SENDING&&!this.props.isPollingTagSuggestions)return null;return k.createElement('div',{className:this.props.isPollingTagSuggestions?"_2d1s":''},k.createElement(i,{className:"_5r-2"}));}.bind(this),this.getPreview=function(da,ea){if(this.props.state!==h.UPLOADED)return null;if(!this.state.previewLoaded)return null;return k.createElement(l,{className:"_5r-3",src:this.props.imageURI,width:da,height:ea});}.bind(this),this.getError=function(){if(this.props.state!==h.ERROR)return null;return k.createElement('div',{className:"_5r-4"});}.bind(this),this.getAbortButton=function(){var da=this.props.shouldShowWhiteDesign?"_3lx9":"_5r-6",ea=this.props.shouldShowWhiteDesign?"_3lxa":"_5r-5";return k.createElement(m,{'aria-label':o._("Remove photo"),className:ea,'data-sigil':'touchable',onClick:this.props.onRemoveClick},k.createElement('div',{className:da}));}.bind(this),this.getTagCountIndicator=function(){if(this.props.state!==h.UPLOADED)return null;if(!this.state.previewLoaded)return null;var da=this.props.tagCount;if(!da)return null;var ea="_5pt"+(da===1?' '+"_5pu":'')+(da===2?' '+"_5pv":'')+(da>2?' '+"_5pw":'');return k.createElement('div',{className:ea});}.bind(this),this.getPhotoBorder=function(){var da=null;if(this.props.shouldShowWhiteDesign)da=k.createElement('div',{className:"_23rn"});return da;}.bind(this),z;}x.prototype.componentDidMount=function(){'use strict';this.$Attachment1=true;if(this.props.state===h.UPLOADED&&!this.state.previewLoaded)this.loadPreview();};x.prototype.componentDidUpdate=function(y,z){'use strict';if(this.refs.progressBar)if(this.props.state===h.SENDING&&this.props.loaded&&this.props.totalSize)if(this.props.loaded===this.props.totalSize){this.refs.progressBar.animate(100,v);}else{var aa=100*t*this.props.loaded/this.props.totalSize;this.refs.progressBar.animate(aa,u);}if(y.state!==h.UPLOADED&&this.props.state===h.UPLOADED)this.loadPreview();if(!z.previewLoaded&&this.state.previewLoaded&&this.props.onPreviewLoaded)this.props.onPreviewLoaded();};x.prototype.componentWillUnmount=function(){'use strict';this.$Attachment1=false;};x.prototype.loadPreview=function(){'use strict';var y=++this.$Attachment2;if(this.refs.progressBar)this.refs.progressBar.animate(100,v);var z=new Image();z.onload=function(){if(!this.$Attachment1||y!==this.$Attachment2)return;if(this.refs.progressBar){this.refs.progressBar.animate(100,w);setTimeout(function(){if(!this.$Attachment1||y!==this.$Attachment2)return;this.setState({previewLoaded:true});}.bind(this),w);}else this.setState({previewLoaded:true});}.bind(this);z.src=this.props.imageURI;if(z.complete||z.width+z.height>0){z.onload=null;this.setState({previewLoaded:true});}};x.prototype.getSphericalPhotoIcon=function(){'use strict';if(!this.props.isSpherical)return null;return k.createElement('div',{className:"_42p8"+(!this.state.previewLoaded||this.props.state!==h.UPLOADED?' '+"_42p9":'')});};x.prototype.render=function(){'use strict';var y;if(this.props.shouldShowWhiteDesign){y="_s50";}else if(this.props.shouldShowLargeThumbnails){y="_3vnj";}else y="_51s2";var z=this.props.previewSize-s,aa=z;if(this.props.state===h.UPLOADED&&this.state.previewLoaded&&this.props.shouldShowLargeThumbnails)aa=Math.floor(this.props.thumbnail_width*z/this.props.thumbnail_height);var ba={width:aa};return k.createElement('div',{className:p(this.props.className,y),style:ba},k.createElement('div',{onClick:this.props.onThumbnailClicked,'data-sigil':'touchable',role:'presentation'},this.getLoadingIndicator(),this.getPreview(aa,z),this.getError(),this.getTagCountIndicator(),this.getPhotoBorder(),this.getSphericalPhotoIcon()),this.getAbortButton());};f.exports=x;}),null);
__d("MMultiPhotoUploaderHiddenInputs.react",["React"],(function a(b,c,d,e,f,g,h){var i,j,k=h.PropTypes;i=babelHelpers.inherits(l,h.Component);j=i&&i.prototype;l.prototype.render=function(){"use strict";var m=null;if(this.props.waterfallSource)m=h.createElement("input",{name:"waterfall_source",type:"hidden",value:this.props.waterfallSource});return h.createElement("div",null,m,this.props.fbids.map(function(n){return h.createElement("input",{key:n,type:"hidden",name:'photo_ids['+n+']',value:n});}));};function l(){"use strict";i.apply(this,arguments);}l.propTypes={fbids:k.array.isRequired,waterfallSource:k.string};f.exports=l;}),null);
__d('MMultiPhotoUploaderPlusAttachment.react',['MXUILayout.react','MXUILayoutFillColumn.react','React','ShimButton.react','cx','fbt'],(function a(b,c,d,e,f,g,h,i,j,k,l,m){var n,o;n=babelHelpers.inherits(p,j.Component);o=n&&n.prototype;function p(){var q,r;'use strict';for(var s=arguments.length,t=Array(s),u=0;u<s;u++)t[u]=arguments[u];return r=(q=o.constructor).call.apply(q,[this].concat(t)),this.getAttachmentChildContainer=function(){if(!this.props.shouldShowWhiteDesign)return null;var v=this.props.shouldShowAddPhotoLabel?j.createElement('div',{className:"_vbw"},m._("photo")):null;return j.createElement(h,null,j.createElement(i,{alignself:'center',className:"_2-24"},j.createElement('div',{className:"_vbx"},j.createElement('div',{className:"_vby"}),v)));}.bind(this),this.getAttachmentClass=function(){var v,w=this.props.largeThumbnails;if(this.props.shouldShowWhiteDesign){v="_vbz";}else v=(w?"_3vnj":'')+(!w?' '+"_51s2":'')+(w?' '+"_14y0":'')+(!w?' '+"_5e0r":'');return v;}.bind(this),r;}p.prototype.render=function(){'use strict';var q=this.getAttachmentClass(),r=this.getAttachmentChildContainer();return j.createElement(k,{'aria-label':m._("Add photo"),className:q,'data-sigil':'touchable',onClick:this.props.onClick},r);};f.exports=p;}),null);
__d('MPhotoUploadDisable',['DOM','Stratcom','fbt'],(function a(b,c,d,e,f,g,h,i,j){var k={IOS_8_PHOTO_UPLOAD_DISABLE_MESSAGE:j._("Sorry, photo uploading isn't available for Safari in iOS 8.0 and 8.0.1. Apple has fixed this in the latest version of iOS. Please upgrade to iOS 8.0.2 and try again."),alertIOS8FileUploadDisabled:function l(event){alert(this.IOS_8_PHOTO_UPLOAD_DISABLE_MESSAGE);event.kill();},disableIOS8FileUpload:function l(m){this._listeners=[h.listen(m,'click',null,this.alertIOS8FileUploadDisabled.bind(this)),i.listen('m:page:unload',null,this._cleanup.bind(this))];},_cleanup:function l(){this._listeners.forEach(function(m){m.remove();});}};f.exports=k;}),null);
__d('MPhotoUploadFileInput',['DOM','MTouchClick','Stratcom'],(function a(b,c,d,e,f,g,h,i,j){function k(l){'use strict';this.$MPhotoUploadFileInput1=l;}k.prototype.setChangeHandler=function(l){'use strict';this.$MPhotoUploadFileInput2&&this.$MPhotoUploadFileInput2.remove();this.$MPhotoUploadFileInput3=l;if(this.$MPhotoUploadFileInput3!=null)this.$MPhotoUploadFileInput2=h.listen(this.$MPhotoUploadFileInput1,'change',null,this.$MPhotoUploadFileInput3);};k.prototype.setClickHandler=function(l){'use strict';this.$MPhotoUploadFileInput4&&this.$MPhotoUploadFileInput4.remove();this.$MPhotoUploadFileInput5=l;if(this.$MPhotoUploadFileInput5!=null)this.$MPhotoUploadFileInput4=h.listen(this.$MPhotoUploadFileInput1,'click',null,this.$MPhotoUploadFileInput5);};k.prototype.destroy=function(){'use strict';this.setChangeHandler(null);this.setClickHandler(null);};k.prototype.getDOMElement=function(){'use strict';return this.$MPhotoUploadFileInput1;};k.prototype.cloneDOMNode=function(){'use strict';var l=this.$MPhotoUploadFileInput1;this.$MPhotoUploadFileInput1=l.cloneNode(true);this.$MPhotoUploadFileInput1.value='';h.replace(l,this.$MPhotoUploadFileInput1);if(this.$MPhotoUploadFileInput3)this.setChangeHandler(this.$MPhotoUploadFileInput3);if(this.$MPhotoUploadFileInput5)this.setClickHandler(this.$MPhotoUploadFileInput5);return l;};k.prototype.click=function(l){'use strict';var event=l.nativeEvent,m=event.changedTouches;i.click(this.$MPhotoUploadFileInput1,{getRawEvent:function n(){return event;},getTouch:function n(){return m&&m[0]||{};}});};f.exports=k;}),null);
/**
 * Mega pixel image rendering library for iOS6 Safari
 *
 * @providesModule MegaPixImage
 * @preserve-header
 *
 * Fixes iOS6 Safari's image file rendering issue for large size image (over mega-pixel),
 * which causes unexpected subsampling when drawing it in canvas.
 * By using this library, you can safely render the image with proper stretching.
 *
 * Copyright (c) 2012 Shinichi Tomita <shinichi.tomita@gmail.com>
 * Released under the MIT license
 */
__d("MegaPixImage",[],(function a(b,c,d,e,f,g){function h(o){var p=o.naturalWidth,q=o.naturalHeight;if(p*q>1024*1024){var r=document.createElement('canvas');r.width=r.height=1;var s=r.getContext('2d');s.drawImage(o,-p+1,0);return s.getImageData(0,0,1,1).data[3]===0;}else return false;}function i(o,p,q){var r=document.createElement('canvas');r.width=1;r.height=q;var s=r.getContext('2d');s.drawImage(o,0,0);var t=s.getImageData(0,0,1,q).data,u=0,v=q,w=q;while(w>u){var x=t[(w-1)*4+3];if(x===0){v=w;}else u=w;w=v+u>>1;}var y=w/q;return y===0?1:y;}function j(o,p,q){var r=document.createElement('canvas');k(o,r,p,q);return r.toDataURL("image/jpeg",p.quality||.8);}function k(o,p,q,r){var s=o.naturalWidth,t=o.naturalHeight,u=q.width,v=q.height,w=p.getContext('2d');w.save();l(p,u,v,q.orientation);var x=h(o);if(x){s/=2;t/=2;}var y=1024,z=document.createElement('canvas');z.width=z.height=y;var aa=z.getContext('2d'),ba=r?i(o,s,t):1,ca=Math.ceil(y*u/s),da=Math.ceil(y*v/t/ba),ea=0,fa=0;while(ea<t){var ga=0,ha=0;while(ga<s){aa.clearRect(0,0,y,y);aa.drawImage(o,-ga,-ea);w.drawImage(z,0,0,y,y,ha,fa,ca,da);ga+=y;ha+=ca;}ea+=y;fa+=da;}w.restore();z=aa=null;}function l(o,p,q,r){switch(r){case 5:case 6:case 7:case 8:o.width=q;o.height=p;break;default:o.width=p;o.height=q;}var s=o.getContext('2d');switch(r){case 2:s.translate(p,0);s.scale(-1,1);break;case 3:s.translate(p,q);s.rotate(Math.PI);break;case 4:s.translate(0,q);s.scale(1,-1);break;case 5:s.rotate(.5*Math.PI);s.scale(1,-1);break;case 6:s.rotate(.5*Math.PI);s.translate(0,-q);break;case 7:s.rotate(.5*Math.PI);s.translate(p,-q);s.scale(-1,1);break;case 8:s.rotate(-.5*Math.PI);s.translate(-p,0);break;default:break;}}var m=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;function n(o){if(o instanceof Blob){var p=new Image();if(!m)throw Error("No createObjectURL function found to create blob url");p.src=m.createObjectURL(o);this.blob=o;o=p;}if(!o.naturalWidth&&!o.naturalHeight){var q=this;o.onload=function(){var r=q.imageLoadListeners;if(r){q.imageLoadListeners=null;for(var s=0,t=r.length;s<t;s++)r[s]();}};this.imageLoadListeners=[];}this.srcImage=o;}n.isSupported=!!m;n.prototype.render=function(o,p){if(this.imageLoadListeners){var q=this;this.imageLoadListeners.push(function(){q.render(o,p);});return;}p=p||{};var r=this.srcImage.naturalWidth,s=this.srcImage.naturalHeight,t=p.width,u=p.height,v=p.maxWidth,w=p.maxHeight,x=!this.blob||this.blob.type==='image/jpeg';if(t&&!u){u=s*t/r<<0;}else if(u&&!t){t=r*u/s<<0;}else{t=r;u=s;}if(v&&t>v){t=v;u=s*t/r<<0;}if(w&&u>w){u=w;t=r*u/s<<0;}var y={width:t,height:u};for(var z in p)y[z]=p[z];var aa=o.tagName.toLowerCase();if(aa==='img'){o.src=j(this.srcImage,y,x);}else if(aa==='canvas')k(this.srcImage,o,y,x);if(typeof this.onrender==='function')this.onrender(o);};f.exports=n;}),null);
__d('PhotosUploadWaterfallXMixin',['AsyncSignal','Banzai','Map','PhotosUploadWaterfallXConfig','Set','invariant','randomInt'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n){var o=new j();function p(r,s){var t={};r.client_time=Math.round(Date.now()/1000);if(k.retryBanzai){t.retry=true;r.nonce=n(4294967296);}i.post(k.banzaiRoute,r,t);if(s)setTimeout(s,0);}function q(r,s){if(k.useBanzai){p(r,s);}else{var t=new h(k.loggingEndpoint,{data:JSON.stringify(r)}).setHandler(s);if(k.timeout)t.setTimeout(10*1000);t.send();}}f.exports={logStep:function r(s,t,u){var v=this.getWaterfallID&&this.getWaterfallID(),w=this.getWaterfallAppName&&this.getWaterfallAppName();if(!v||!w)return;q(babelHelpers['extends']({step:s,qn:v,uploader:w,ref:this.getWaterfallSource&&this.getWaterfallSource()},t),u);},logPUWStep:function r(s,t,u,v,w,x,y){if(x&&x.logOncePerSession){if(!o.has(t))o.set(t,new l());if(o.get(t).has(s))return;o.get(t).add(s);}q(Object.assign({step:s,qn:t,uploader:u,ref:v},w),y);}};}),null);
__d("base64toUint8Array",[],(function a(b,c,d,e,f,g){function h(i){var j=atob(i),k=j.length,l=new Uint8Array(k);for(var m=0;m<k;m++)l[m]=j.charCodeAt(m);return l;}f.exports=h;}),null);
__d('DataViewPolyfill',[],(function a(b,c,d,e,f,g){'use strict';function h(i,j,k){if(j===undefined){this.$DataViewPolyfill1=new Uint8Array(i);}else if(k===undefined){this.$DataViewPolyfill1=new Uint8Array(i,j);}else this.$DataViewPolyfill1=new Uint8Array(i,j,k);this.byteLength=this.$DataViewPolyfill1.byteLength;}h.prototype.getUint8=function(i){if(i>=this.$DataViewPolyfill1.length)throw new Error('Trying to read beyond bounds of DataViewPolyfill');return this.$DataViewPolyfill1[i];};h.prototype.getUint16=function(i,j){var k=this.getUint8(i),l=this.getUint8(i+1);return j?l*256+k:k*256+l;};h.prototype.getUint32=function(i,j){var k=this.getUint8(i),l=this.getUint8(i+1),m=this.getUint8(i+2),n=this.getUint8(i+3);return j?((n*256+m)*256+l)*256+k:((k*256+l)*256+m)*256+n;};h.isSupported=function(){return !!b.Uint8Array;};f.exports=h;}),null);
__d("getExifOrientation",["DataViewPolyfill"],(function a(b,c,d,e,f,g,h){var i=b.DataView||h;function j(k,l){var m=new FileReader();m.onload=function(n){var o="Exif\0\0",p=0,q,r=new i(n.target.result);for(var s=0;s<250;s++)if(r.getUint8(s)===o.charCodeAt(p)){p+=1;q=s+1;if(p===o.length)break;}else p=0;if(!p){l(null);return;}var t;if(r.getUint8(q)==77&&r.getUint8(q+1)==77){t=false;}else if(r.getUint8(q)==73&&r.getUint8(q+1)==73){t=true;}else{l(null);return;}q+=2;q+=2;var u,v,w,x;u=r.getUint32(q,t);q+=u-8+4;v=r.getUint16(q,t);q+=2;for(var y=0;y<Math.min(25,v);y++){w=r.getUint16(q,t);q+=8;if(w==274){x=r.getUint16(q,t);l(x);return;}q+=4;}l(null);};m.readAsArrayBuffer(k);}f.exports=j;}),null);
__d('MPhotoResizer',['base64toUint8Array','getExifOrientation','invariant','mixin','performanceNow','requestAnimationFrame','PhotosUploadWaterfallXMixin','PUWSteps','MegaPixImage','Vector'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r,s,t='data:image/jpeg;base64,';r=babelHelpers.inherits(u,k(n));s=r&&r.prototype;function u(){'use strict';s.constructor.call(this);this.$MPhotoResizer1=new q(960,960);this.$MPhotoResizer2=.85;}u.prototype.setFile=function(v){'use strict';this.$MPhotoResizer3=v;return this;};u.prototype.setDimensions=function(v){'use strict';this.$MPhotoResizer1=v;return this;};u.prototype.setQuality=function(v){'use strict';this.$MPhotoResizer2=v;return this;};u.prototype.setHandler=function(v){'use strict';this.$MPhotoResizer4=v;return this;};u.prototype.setWaterfall=function(v,w,x){'use strict';this.$MPhotoResizer5=v;this.$MPhotoResizer6=w;this.$MPhotoResizer7=x;return this;};u.prototype.resize=function(){'use strict';this.$MPhotoResizer3||j(0);this.$MPhotoResizer1||j(0);this.$MPhotoResizer2||j(0);this.$MPhotoResizer4||j(0);this.$MPhotoResizer5||j(0);this.$MPhotoResizer6||j(0);if(!p.isSupported){this.logStep(o.CLIENT_PROCESS_UNAVAILABLE,{error:'canvas_not_supported'});this.$MPhotoResizer4(this.$MPhotoResizer3);return;}if(!this.$MPhotoResizer8()){this.logStep(o.CLIENT_PROCESS_UNAVAILABLE,{error:'no_jpeg_output'});this.$MPhotoResizer4(this.$MPhotoResizer3);return;}this.logStep(o.CLIENT_PROCESS_BEGIN);var v=l();i(this.$MPhotoResizer3,function(w){m(function(){var x=document.createElement('canvas'),y=new p(this.$MPhotoResizer3);y.onrender=function(){m(function(){var z=x.toDataURL('image/jpeg',this.$MPhotoResizer2);x=null;z=z.substr(t.length);m(function(){var aa=h(z);z=null;var ba=new Blob([aa.buffer],{type:'image/jpeg'});this.logStep(o.CLIENT_PROCESS_SUCCESS,{timeResizing:l()-v,originalSize:this.$MPhotoResizer3&&this.$MPhotoResizer3.size,resizedSize:ba&&ba.size});this.$MPhotoResizer4(ba);}.bind(this));}.bind(this));}.bind(this);y.render(x,{maxWidth:this.$MPhotoResizer1.x,maxHeight:this.$MPhotoResizer1.y,orientation:w});}.bind(this));}.bind(this));};u.prototype.$MPhotoResizer8=function(){'use strict';var v=document.createElement('canvas');v.width=1;v.height=1;var w=v.toDataURL('image/jpeg');return w.substr(0,t.length)===t;};u.prototype.getWaterfallID=function(){'use strict';return this.$MPhotoResizer5;};u.prototype.getWaterfallAppName=function(){'use strict';return this.$MPhotoResizer6;};u.prototype.getWaterfallSource=function(){'use strict';return this.$MPhotoResizer7;};f.exports=u;}),null);
__d("XMobilePhotosSaveUnpublishedController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/_mupload_\/photo\/x\/saveunpublished\/",{allow_spherical_photo:{type:"Bool",defaultValue:false},thumbnail_width:{type:"Int"},thumbnail_height:{type:"Int"},waterfall_app_name:{type:"String"},waterfall_id:{type:"String"},waterfall_source:{type:"String"},filter_type:{type:"Int"},use_autoenhance:{type:"Exists",defaultValue:false},upload_id:{type:"String"},target_id:{type:"Int"},csid:{type:"String"},js_request_module_name:{type:"String"}});}),null);
__d('supportsXHR2',['memoize'],(function a(b,c,d,e,f,g,h){function i(){if(!window.FormData||!window.XMLHttpRequest)return false;var j=new XMLHttpRequest();return 'upload' in j&&'withCredentials' in j;}f.exports=h(i);}),null);
__d('MPhotoUploadRequest',['ActorURI','CurrentUser','DOM','MRequest','PhotosUploadWaterfallXMixin','PUWSteps','XMobilePhotosSaveUnpublishedController','invariant','mixin','performanceNow','supportsXHR2','MPhotoResizer'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t,u;t=babelHelpers.inherits(v,p(l));u=t&&t.prototype;function v(){'use strict';u.constructor.call(this);this.$MPhotoUploadRequest1=0;}v.prototype.setClonedFileInput=function(y){'use strict';this.$MPhotoUploadRequest2=y;return this;};v.prototype.setAttachedFile=function(y){'use strict';this.$MPhotoUploadRequest3=y;return this;};v.prototype.setDTSG=function(y){'use strict';this.$MPhotoUploadRequest4=y;return this;};v.prototype.setUploadDomain=function(y){'use strict';this.$MPhotoUploadRequest5=y;return this;};v.prototype.setWaterfall=function(y,z,aa){'use strict';this.$MPhotoUploadRequest6=y;this.$MPhotoUploadRequest7=z;this.$MPhotoUploadRequest8=aa;return this;};v.prototype.setHandler=function(y){'use strict';this.$MPhotoUploadRequest9=y;return this;};v.prototype.setProgressHandler=function(y){'use strict';this.$MPhotoUploadRequest10=y;return this;};v.prototype.setErrorHandler=function(y){'use strict';this.$MPhotoUploadRequest11=y;return this;};v.prototype.setThumbnailDimensions=function(y){'use strict';this.$MPhotoUploadRequest12=y;return this;};v.prototype.setShouldResize=function(y){'use strict';this.$MPhotoUploadRequest13=y;return this;};v.prototype.setTargetID=function(y){'use strict';this.$MPhotoUploadRequest14=y;return this;};v.prototype.setActorID=function(y){'use strict';this.$MPhotoUploadRequest15=y;return this;};v.prototype.setAllowSphericalPhoto=function(y){'use strict';this.$MPhotoUploadRequest16=y;return this;};v.prototype.setJpegResizer=function(y){'use strict';return this;};v.prototype.send=function(){'use strict';this.$MPhotoUploadRequest2||o(0);this.$MPhotoUploadRequest5||o(0);this.$MPhotoUploadRequest4||o(0);this.$MPhotoUploadRequest6||o(0);this.$MPhotoUploadRequest7||o(0);this.$MPhotoUploadRequest8||o(0);this.$MPhotoUploadRequest9||o(0);this.$MPhotoUploadRequest12||o(0);!this.$MPhotoUploadRequest17&&!this.$MPhotoUploadRequest18||o(0);if(!r()){this.$MPhotoUploadRequest19();}else this.$MPhotoUploadRequest20();return this;};v.prototype.$MPhotoUploadRequest21=function(y,z){'use strict';this.logStep(y,babelHelpers['extends']({retriesNeeded:this.$MPhotoUploadRequest1},z||{}));};v.prototype.abort=function(y){'use strict';if(!this.$MPhotoUploadRequest2)return;this.$MPhotoUploadRequest21(m.CLIENT_TRANSFER_CANCEL,{elapsed_time:q()-this.transferStartTime,bytes:this.fileSize,progress:y});if(r()){this.$MPhotoUploadRequest22();}else this.$MPhotoUploadRequest23();};v.prototype.retry=function(){'use strict';this.$MPhotoUploadRequest1++;this.abort();this.send();};v.prototype.$MPhotoUploadRequest24=function(){'use strict';var y=this.$MPhotoUploadRequest2.files;return y&&y.item&&y.item(0)&&y.item(0).size;};v.prototype.$MPhotoUploadRequest25=function(){'use strict';var y=n.getURIBuilder().setBool('allow_spherical_photo',this.$MPhotoUploadRequest16).setInt('thumbnail_width',this.$MPhotoUploadRequest12.x).setInt('thumbnail_height',this.$MPhotoUploadRequest12.y).setString('waterfall_id',this.$MPhotoUploadRequest6).setString('waterfall_app_name',this.$MPhotoUploadRequest7).setString('waterfall_source',this.$MPhotoUploadRequest8).setInt('target_id',this.$MPhotoUploadRequest14).getURI().setProtocol(this.$MPhotoUploadRequest5.getProtocol()).setDomain(this.$MPhotoUploadRequest5.getDomain());return h.create(y,this.$MPhotoUploadRequest15);};v.prototype.$MPhotoUploadRequest20=function(){'use strict';var y=this.$MPhotoUploadRequest3,z=this.$MPhotoUploadRequest13||'no_resize';if(y&&z=='canvas_resize'){new s().setFile(y).setWaterfall(this.$MPhotoUploadRequest6,this.$MPhotoUploadRequest7,this.$MPhotoUploadRequest8).setHandler(function(aa){this.$MPhotoUploadRequest26(aa);}.bind(this)).resize();}else this.$MPhotoUploadRequest26(y);};v.prototype.$MPhotoUploadRequest26=function(y){'use strict';var z=new FormData();z.append(this.$MPhotoUploadRequest2.name,y);this.fileSize=y.size;this.transferStartTime=q();this.$MPhotoUploadRequest21(m.CLIENT_TRANSFER_BEGIN,{bytes:this.fileSize});var aa=this.$MPhotoUploadRequest17=new k(this.$MPhotoUploadRequest25()).setCORS(true).setData({fb_dtsg:this.$MPhotoUploadRequest4}).setRawData(z);aa.listen('open',function(ba){var ca=ba.getTransport();ca.withCredentials=true;});aa.listen('done',function(ba){this.$MPhotoUploadRequest21(m.CLIENT_TRANSFER_SUCCESS,{elapsed_time:q()-this.transferStartTime,bytes:this.fileSize,fbid:ba.fbid});this.$MPhotoUploadRequest9(ba);}.bind(this));aa.listen('error',function(ba){this.$MPhotoUploadRequest21(m.CLIENT_TRANSFER_FAIL,{error_type:'mrequest_fail',elapsed_time:q()-this.transferStartTime,bytes:this.fileSize});this.$MPhotoUploadRequest11&&this.$MPhotoUploadRequest11(ba);}.bind(this));aa.listen('uploadprogress',function(ba){this.$MPhotoUploadRequest10&&this.$MPhotoUploadRequest10(ba);}.bind(this));aa.send();};v.prototype.$MPhotoUploadRequest22=function(){'use strict';this.$MPhotoUploadRequest17&&this.$MPhotoUploadRequest17.abort();this.$MPhotoUploadRequest17=null;};v.prototype.$MPhotoUploadRequest27=function(y,z){'use strict';return j.create('input',{type:'hidden',name:y,value:z});};v.prototype.$MPhotoUploadRequest19=function(){'use strict';var y='MPhotoUpload'+w++,z=this.$MPhotoUploadRequest18=j.create('iframe',{name:y,id:y});z.style.display='none';var aa=this.$MPhotoUploadRequest28=j.create('form',{target:y,action:this.$MPhotoUploadRequest25().toString(),method:'POST',enctype:'multipart/form-data'});aa.style.display='none';var ba={fb_dtsg:this.$MPhotoUploadRequest4,__a:1,__user:i.getID(),upload_id:y};for(var ca in ba)j.appendContent(aa,this.$MPhotoUploadRequest27(ca,ba[ca]));j.appendContent(document.body,z);j.appendContent(document.body,aa);j.appendContent(aa,this.$MPhotoUploadRequest2);this.fileSize=this.$MPhotoUploadRequest24();x[y]=function(ea){if(!ea){this.$MPhotoUploadRequest29('no_payload');return;}delete x[y];this.$MPhotoUploadRequest23();this.$MPhotoUploadRequest21(m.CLIENT_TRANSFER_SUCCESS,{elapsed_time:q()-this.transferStartTime,bytes:this.fileSize,fbid:ea.fbid});this.$MPhotoUploadRequest9(ea);}.bind(this);z.onerror=this.$MPhotoUploadRequest29.bind('iframe_onerror');this.transferStartTime=q();this.$MPhotoUploadRequest21(m.CLIENT_TRANSFER_BEGIN,{bytes:this.fileSize});var da=window.location.hostname.match(/\.(facebook\.sg|facebookcorewwwi\.onion)$/);document.domain=da?da[1]:'facebook.com';aa.submit();};v.prototype.$MPhotoUploadRequest29=function(y){'use strict';this.$MPhotoUploadRequest21(m.CLIENT_TRANSFER_FAIL,{error_type:y,elapsed_time:q()-this.transferStartTime,bytes:this.fileSize});this.$MPhotoUploadRequest11&&this.$MPhotoUploadRequest11();this.$MPhotoUploadRequest23();};v.prototype.$MPhotoUploadRequest23=function(){'use strict';this.$MPhotoUploadRequest18&&j.remove(this.$MPhotoUploadRequest18);this.$MPhotoUploadRequest18=null;this.$MPhotoUploadRequest28&&j.remove(this.$MPhotoUploadRequest28);this.$MPhotoUploadRequest28=null;};v.prototype.getWaterfallID=function(){'use strict';return this.$MPhotoUploadRequest6;};v.prototype.getWaterfallAppName=function(){'use strict';return this.$MPhotoUploadRequest7;};v.prototype.getWaterfallSource=function(){'use strict';return this.$MPhotoUploadRequest8;};v.handleResponse=function(y,z){'use strict';x[y](z);};var w=0,x={};f.exports=v;}),null);
__d('MMultiPhotoUploader.react',['cx','fbt','forEachObject','intlNumUtils','Bootloader','MSphericalPhotoConfig','MPhotoUploadRequest','PhotosUploadWaterfallXMixin','PUWSteps','React','ReactDOM','Stratcom','Vector','MMultiPhotoUploaderAttachment.react','MMultiPhotoUploaderAttachmentState','MPhotoUploadDisable','MPhotoUploadFileInput','MMultiPhotoUploaderPlusAttachment.react','MMultiPhotoUploaderHiddenInputs.react','URI'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){var ba=q.PropTypes,ca=0,da=80,ea=56,fa,ga=q.createClass({displayName:'MMultiPhotoUploader',_pendingUploadRequests:{},propTypes:{dtsg:ba.string.isRequired,fileInput:ba.instanceOf(x).isRequired,formHiddenInputs:ba.instanceOf(HTMLElement).isRequired,uploadDomain:ba.instanceOf(aa).isRequired,waterfallID:ba.string.isRequired,waterfallAppName:ba.string.isRequired,waterfallSource:ba.string.isRequired,actorID:ba.string,targetID:ba.string,maxPhotosAllowed:ba.number,initCollapsed:ba.bool,logFlowBeginOnClick:ba.bool,shouldScroll:ba.bool,shouldShowLargeThumbnails:ba.bool,shouldShowWhiteDesign:ba.bool,shouldShowAddPhotoLabel:ba.bool,showDropShadow:ba.bool,disableIOS8SafariAlert:ba.bool,onUploadSuccess:ba.func,onRemove:ba.func,onThumbnailClicked:ba.func,onUploadStarted:ba.func,initialPhotos:ba.array},mixins:[o],setCollapsed:function ha(ia){this.setState({collapsed:ia});},isCollapsed:function ha(){return this.state.collapsed;},isSinglePhoto:function ha(){return +this.props.maxPhotosAllowed===1;},getAttachmentCount:function ha(){return this.attachments.length;},hasAttachments:function ha(){return this.attachments.length>0;},clearAttachments:function ha(){this.setAttachments(this.attachments.filter(function(ia){if(ia.state===v.SENDING)ia.request.abort();return false;}));},getInitialState:function ha(){var ia=this.props.initialPhotos;if(ia!==null){for(var ja=0;ja<ia.length;ja++){ia[ja].id=ca++;ia[ja].state=v.UPLOADED;}var ka={};ka[v.UPLOADED]=ia.length;s.invoke('MMultiPhotoUploader:attachments:change',null,ka);}this.attachments=ia?ia:[];return {attachments:this.attachments,collapsed:this.props.initCollapsed};},numAttachmentsWithState:function ha(ia){return this.attachments.filter(function(ja){return ja.state===ia;}).length;},_numPollingAttachments:function ha(){return this.attachments.filter(function(ia){return ia.isPollingTagSuggestions;}).length;},isMaxAttachmentReached:function ha(){return this.attachments.length>=this.props.maxPhotosAllowed;},setAttachments:function ha(ia){s.invoke('multi-photos-attachment-change',null,{attachments:ia,multiPhotoUploader:this});this.setAttachmentsSilent(ia);},setAttachmentsSilent:function ha(ia){this.attachments=ia;this.setState({attachments:ia});var ja=this.props.fileInput.getDOMElement();ja.disabled=this.isMaxAttachmentReached();s.invoke('multi-photos-change',null,{input_id:ja.id});var ka={input_id:ja.id};for(var la in v){if(!Object.prototype.hasOwnProperty.call(v,la)||typeof v[la]!=='string')continue;var ma=v[la];ka[ma]=this.numAttachmentsWithState(ma);}ka.polling=this._numPollingAttachments();s.invoke('MMultiPhotoUploader:attachments:change',null,ka);},addAttachment:function ha(ia){s.invoke('MMultiPhotoUploader:attachments:add',null,{photo_count:ia.length||1});this.setAttachments(this.attachments.concat([ia]));},removeAttachment:function ha(ia){s.invoke('MMultiPhotoUploader:attachments:remove',null,{photo_count:1});this.setAttachments(this.attachments.filter(function(ja){if(ja.id===ia){if(ja.state===v.SENDING){var ka=0;if(ja.totalSize)ka=Math.floor(100*(ja.loaded/ja.totalSize));ja.request.abort(ka);}else this.logStep(p.CLIENT_UPLOAD_REMOVE,{fbid:ja.fbid});if(ja.fbid)this.props.onRemove&&this.props.onRemove(ja.fbid);return false;}return true;}.bind(this)));},updateAttachment:function ha(ia){this.setAttachments(this.attachments.map(function(ja){if(ja.id===ia.id)return ia;return ja;}));},getAttachment:function ha(ia){return this.attachments.filter(function(ja){return ja.id===ia;})[0];},setAttachmentProps:function ha(ia,ja){var ka=this.getAttachment(ia),la={};for(var ma in ka)la[ma]=ka[ma];for(ma in ja)la[ma]=ja[ma];this.updateAttachment(la);},retryAttachment:function ha(ia){var ja=this.getAttachment(ia);this.logStep(p.CLIENT_ATTEMPT_RETRY,{fbid:ja.fbid});ja.request.retry();this.updateAttachment({id:ia,state:'sending',request:ja.request});},setAttachmentTagCounts:function ha(ia){this.setAttachmentsSilent(this.attachments.map(function(ja){ja.tagCount=ia[ja.id];return ja;}));},componentDidMount:function ha(){this.props.fileInput.setChangeHandler(this.onFileInputChange);this.props.fileInput.setClickHandler(this.onFileInputClick);if(!this.hasAttachments()&&!this.props.logFlowBeginOnClick)this.logStep(p.CLIENT_FLOW_BEGIN);this.renderHiddenInputs();this.resizeAndScroll();},componentWillUnmount:function ha(){r.unmountComponentAtNode(this.props.formHiddenInputs);this.props.fileInput.setChangeHandler(null);this.props.fileInput.setClickHandler(null);j(this._pendingUploadRequests,function(ia){return ia.abort();});delete this._pendingUploadRequests;},onFileInputChange:function ha(){var ia=this.props.fileInput.getDOMElement();s.invoke('MMultiPhotoUploader:input:change',null,{input:ia});this.uploadPhotos(ia.files);},onFileInputClick:function ha(event){if(this.props.disableIOS8SafariAlert===true)w.alertIOS8FileUploadDisabled(event);if(!this.hasAttachments()&&this.props.logFlowBeginOnClick)this.logStep(p.CLIENT_FLOW_BEGIN);this.logStep(p.CLIENT_SELECT_BEGIN);s.invoke('MMultiPhotoUploader:input:click',null,{input:this.props.fileInput.getDOMElement()});},uploadPhotos:function ha(ia){var ja,ka=this;if(ia.length===0){this.logStep(p.CLIENT_SELECT_FAIL);return;}var la=this.props.fileInput.cloneDOMNode(),ma=function oa(pa){var qa=ia[pa];if(qa.name===''&&qa.fileName===''&&qa.size===0&&qa.fileSize===0){ka.logStep(p.CLIENT_SELECT_FAIL);return 'continue';}ka.logStep(p.CLIENT_SELECT_SUCCESS);var ra=ca++,sa=ka.props.shouldShowLargeThumbnails?da:ea,ta=ka.props,ua=ta.targetID,va=ta.actorID,wa=new n().setClonedFileInput(la).setAttachedFile(qa).setUploadDomain(ka.props.uploadDomain).setThumbnailDimensions(new t(sa,sa)).setDTSG(ka.props.dtsg).setWaterfall(ka.props.waterfallID,ka.props.waterfallAppName,ka.props.waterfallSource).setHandler(ka.handleUploadSuccess.bind(ka,ra)).setErrorHandler(ka.handleUploadError.bind(ka,ra)).setProgressHandler(ka.handleUploadProgress.bind(ka,ra)).setTargetID(ua&&k.parseNumber(ua)).setActorID(va&&k.parseNumber(va)).setAllowSphericalPhoto(true).send();ka._pendingUploadRequests[ra]=wa;ka.props.onUploadStarted&&ka.props.onUploadStarted();if(ka.isSinglePhoto())ka.clearAttachments();ka.addAttachment({id:ra,state:'sending',request:wa});ka.setCollapsed(false);if(m.is_mtouch_basic_uploader_on)l.loadModules(["SphericalImage"],function(xa){xa.createFromBlob(qa).then(function(ya){return this.handleSphericalPhotoCheck(ra,ya);}.bind(this))['catch'](function(ya){}).done();}.bind(ka),'MMultiPhotoUploader.react');};for(var na=0;na<ia.length;na++){var ja=ma(na);if(ja==='continue')continue;}},handleSphericalPhotoCheck:function ha(ia,ja){var ka=this.getAttachment(ia);this.updateAttachment(babelHelpers['extends']({},ka,{isSpherical:ja&&ja.isSpherical()}));},handleUploadError:function ha(ia){delete this._pendingUploadRequests[ia];var ja=this.getAttachment(ia);this.updateAttachment({id:ia,state:'error',request:ja.request,isSpherical:ja.isSpherical});},handleUploadProgress:function ha(ia,ja){var ka=this.getAttachment(ia);this.updateAttachment({id:ia,state:ka.state,request:ka.request,loaded:ja.loaded,totalSize:ja.totalSize,isSpherical:ka.isSpherical});},handleUploadSuccess:function ha(ia,ja){delete this._pendingUploadRequests[ia];if(!ja.fbid){this.handleUploadError(ia);return;}var ka=this.getAttachment(ia);this.updateAttachment({id:ia,state:'uploaded',fbid:ja.fbid,imageURI:ja.thumbnail_uri,thumbnail_width:ja.thumbnail_width,thumbnail_height:ja.thumbnail_height,loaded:ka.loaded,totalSize:ka.totalSize,previewURI:ja.preview_uri,isSpherical:ka.isSpherical});this.props.onUploadSuccess&&this.props.onUploadSuccess(ja.fbid,ia);},onPlusClick:function ha(event){this.props.fileInput.click(event);},onRemoveClick:function ha(ia){var ja=this.getAttachment(ia),ka=false;if(ja.state===v.SENDING||ja.state===v.ERROR)ka=confirm(i._("This photo didn't upload. Do you want to try again?"));if(ka){this.retryAttachment(ia);}else this.removeAttachment(ia);},componentWillUpdate:function ha(){if(this.props.shouldScroll&&this.refs&&this.refs.scroller)this.refs.scroller.checkShouldScrollToEnd();},componentDidUpdate:function ha(){this.renderHiddenInputs();this.resizeAndScroll();},renderHiddenInputs:function ha(){var ia=this.state.attachments.filter(function(ja){return ja.state===v.UPLOADED;}).map(function(ja){return ja.fbid;});r.render(q.createElement(z,babelHelpers['extends']({},this.props,{fbids:ia})),this.props.formHiddenInputs);},resizeAndScroll:function ha(){if(this.props.shouldScroll&&this.refs&&this.refs.scroller){this.refs.scroller.resizeScroller();this.refs.scroller.scrollHorizontallyToEnd();}},getPlusAttachment:function ha(){if(this.isSinglePhoto()&&this.state.collapsed)return null;if(this.isMaxAttachmentReached())return null;return q.createElement(y,{onClick:this.onPlusClick,largeThumbnails:this.props.shouldShowLargeThumbnails,shouldShowWhiteDesign:this.props.shouldShowWhiteDesign,shouldShowAddPhotoLabel:this.props.shouldShowAddPhotoLabel});},adjustScroller:function ha(){if(this.props.shouldScroll&&this.refs&&this.refs.scroller){this.refs.scroller.checkShouldScrollToEnd();this.refs.scroller.resizeScroller();this.refs.scroller.scrollHorizontallyToEnd();}},render:function ha(){if(this.state.collapsed)return q.createElement('div',null);var ia=this.state.attachments.map(function(ka){var la=this.props.shouldShowLargeThumbnails?da:ea;return q.createElement(u,babelHelpers['extends']({},ka,{key:ka.id,shouldShowLargeThumbnails:this.props.shouldShowLargeThumbnails,previewSize:la,shouldShowWhiteDesign:this.props.shouldShowWhiteDesign,onRemoveClick:function(){this.onRemoveClick(ka.id);}.bind(this),onPreviewLoaded:function(){this.adjustScroller();}.bind(this),loaded:ka.loaded,totalSize:ka.totalSize,onThumbnailClicked:function(){this.props.onThumbnailClicked&&this.props.onThumbnailClicked(ka);}.bind(this)}));}.bind(this)),ja=this.props.shouldScroll&&this.state.attachments.length>1;if(ja)if(!fa){l.loadModules(["MMultiPhotoUploaderSimpleScroller"],function(ka){fa=ka;this.forceUpdate();}.bind(this),'MMultiPhotoUploader.react');}else return q.createElement(fa,{options:{scrollingY:false},className:(!this.props.shouldShowLargeThumbnails?"_1upb":'')+(' '+"_xy")+(this.props.showDropShadow?' '+"_bgx":''),thumbnailSize:da,ref:'scroller'},ia,this.getPlusAttachment());return q.createElement('div',{className:"_5cqb"+(ja?' '+"_2nym":'')},ia,this.getPlusAttachment());},getWaterfallID:function ha(){return this.props.waterfallID;},getWaterfallAppName:function ha(){return this.props.waterfallAppName;},getWaterfallSource:function ha(){return this.props.waterfallSource;}});f.exports=ga;}),null);
__d('MMultiPhotoUploaderInitReact',['$','MMultiPhotoUploaderAttachmentState','DOM','ReactComponentRenderer','Run','Stratcom','StratcomManager','SubscriptionsHandler','MMultiPhotoUploader.react','MPhotoUploadFileInput','URI','PUWSteps'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t='m-raw-file-input';function u(v,w){'use strict';var x=v.previewGridElem||h(v.previewGridId),y=v.targetFormElem||h(v.targetFormId),z=v.inputId,aa=v.inputContainerElem,ba=null;if(aa){var ca=j.scry(aa,'input',t)[0];if(ca&&ca.id===z)ba=ca;}ba=ba||h(z);var da=document.createElement('div');j.insertBefore(x,da);var ea=document.createElement('div');j.appendContent(y,ea);var fa=new q(ba);this.$MMultiPhotoUploaderInitReact1=new k(p,da);this.$MMultiPhotoUploaderInitReact1.setProps({fileInput:fa,formHiddenInputs:ea,uploadDomain:new r(v.uploadDomain),dtsg:v.dtsg,shouldResize:v.shouldResize,maxPhotosAllowed:v.maxPhotosAllowed,waterfallID:v.waterfallID,waterfallAppName:v.waterfallAppName,waterfallSource:v.waterfallSource,initCollapsed:v.initCollapsed,logFlowBeginOnClick:v.logFlowBeginOnClick,targetID:v.targetID,actorID:v.actorID,shouldScroll:v.horizontalScrolling,shouldShowLargeThumbnails:v.largeThumbnails,shouldShowWhiteDesign:v.useWhiteDesign,shouldShowAddPhotoLabel:v.showPhotoLabel,showDropShadow:v.composerDropShadow,disableIOS8SafariAlert:v.disableIOS8SafariAlert,initialPhotos:w});n.enableDispatch(window,'reset');var ga=new o();ga.addSubscriptions(m.listen('reset',['id:'+v.targetFormId],function(){this.resetState();}.bind(this)),m.listen('MActorSelector-actorChange',null,function(event){if(event.getData().targetID===v.targetID){this.resetState();this.$MMultiPhotoUploaderInitReact1.setProps({actorID:event.getData().actorID,maxPhotosAllowed:event.getData().maxPhotosAllowed});}}.bind(this)),m.listen('MStructuredComposer-canceled',null,function(){if(!this.$MMultiPhotoUploaderInitReact1.component.isCollapsed())this.$MMultiPhotoUploaderInitReact1.component.logStep(s.CLIENT_FLOW_CANCEL,{volume:this.$MMultiPhotoUploaderInitReact1.component.getAttachmentCount()});}.bind(this)));l.onLeave(function(){this.$MMultiPhotoUploaderInitReact1.unmount();fa.destroy();ga.release();}.bind(this));}u.prototype.logClientPost=function(v){'use strict';this.$MMultiPhotoUploaderInitReact1.component.logStep(s.CLIENT_FLOW_POST,{volume:this.$MMultiPhotoUploaderInitReact1.component.getAttachmentCount()},v);};u.prototype.alterPreviewGrid=function(v){'use strict';return this.$MMultiPhotoUploaderInitReact1.component.setCollapsed(!v);};u.prototype.getUploader=function(){'use strict';return this.$MMultiPhotoUploaderInitReact1;};u.prototype.resetState=function(){'use strict';this.$MMultiPhotoUploaderInitReact1.component.clearAttachments();return this.alterPreviewGrid(false);};u.prototype.hasPhotos=function(){'use strict';return this.$MMultiPhotoUploaderInitReact1.component.numAttachmentsWithState(i.UPLOADED)>0;};u.prototype.getPhotosCount=function(){'use strict';return this.$MMultiPhotoUploaderInitReact1.component.numAttachmentsWithState(i.UPLOADED);};u.prototype.uploadPhotos=function(v){'use strict';this.$MMultiPhotoUploaderInitReact1.component.uploadPhotos(v);};f.exports=u;}),null);
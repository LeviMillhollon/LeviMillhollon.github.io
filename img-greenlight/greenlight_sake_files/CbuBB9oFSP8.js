if (self.CavalryLogger) { CavalryLogger.start_js(["s39uv"]); }

__d('MReactTypeaheadView',['React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;i=babelHelpers.inherits(k,h.Component);j=i&&i.prototype;k.prototype.render=function(){var l=this.props.Renderer;return h.createElement(l,{data:this.props.data,query:this.props.query,waiting:this.props.waiting,loaderMarkup:this.props.loaderMarkup,onTouchStart:this.props.onTouchStart,onClickItem:this.props.onClickItem,simpleSearch:this.props.simpleSearch,excludedEntries:this.props.excludedEntries,maxSuggestionCount:this.props.maxSuggestionCount});};function k(){i.apply(this,arguments);}f.exports=k;}),null);
__d('MLoadingSpinner.react',['MLoadingIndicator.react','React'],(function a(b,c,d,e,f,g,h,i){var j,k;j=babelHelpers.inherits(l,i.Component);k=j&&j.prototype;l.prototype.render=function(){'use strict';return i.createElement('div',{className:this.props.className},i.createElement(h,{background:'light',size:'large'}));};function l(){'use strict';j.apply(this,arguments);}f.exports=l;}),null);
__d("MTokenCollection.react",["React"],(function a(b,c,d,e,f,g,h){var i,j,k=h.PropTypes;i=babelHelpers.inherits(l,h.Component);j=i&&i.prototype;l.prototype.render=function(){"use strict";var m=this.props.renderer,n=this.props.collection.entries.map(function(o,p){var q=null;return h.createElement(m,{collectionKey:this.props.collectionKey,entry:o,index:p,key:o.id,label:o.display,onRemove:this.props.onRemove,testid:q,truncate:this.props.truncateTokens});},this);return h.createElement("span",{className:this.props.className,onClick:this.props.onClick,role:"presentation"},n);};function l(){"use strict";i.apply(this,arguments);}l.propTypes={className:k.string,collection:k.object.isRequired,collectionKey:k.string,onClick:k.func,onRemove:k.func,renderer:k.func.isRequired,tokenTestIDGenerator:k.func,truncateTokens:k.bool};f.exports=l;}),null);
__d('MTokenRenderer.react',['React','cx','joinClasses'],(function a(b,c,d,e,f,g,h,i,j){var k,l,m=h.PropTypes;k=babelHelpers.inherits(n,h.Component);l=k&&k.prototype;function n(){var o,p;'use strict';for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=l.constructor).call.apply(o,[this].concat(r)),this.$MTokenRenderer1=function(t){t.stopPropagation();t.preventDefault();this.props.onRemove&&this.props.onRemove(this.props.entry);}.bind(this),p;}n.prototype.render=function(){'use strict';if(this.props.onRemove)var o="_5snx"+(this.props.truncate?' '+"_p9m":''),p=h.createElement('a',{href:'#',className:o,'data-sigil':'touchable'},h.createElement('span',{className:"_1xe9",onClick:this.$MTokenRenderer1,role:'presentation'},'\u00a0\u00d7\u00a0'));var q="_1xea"+(this.props.truncate?' '+"_p9n":''),r=h.createElement('span',{className:q},this.props.label),s="_5snw"+(this.props.truncate?' '+"_p9o":''),t=h.createElement('input',{type:'hidden',value:this.props.entry.id,name:this.props.collectionKey+'['+this.props.index+']'});return h.createElement('span',babelHelpers['extends']({},this.props,{className:j(this.props.className,s)}),r,p,t);};n.propTypes={collectionKey:m.string,entry:m.object,index:m.number,label:m.string.isRequired,onRemove:m.func,testid:m.string,truncate:m.bool};f.exports=n;}),null);
__d('MReactTypeahead',['DOM','EventEmitter','MPageController','MReactTypeaheadView','MRecentSearchesUpdater','MSearchConst','MSearchTypeaheadLogger','MSearchTypeaheadPerfLoggerUtil','MTypeaheadNullstateSource','MTypeaheadOnDemandSource','MTypeaheadTouchSource','MTypeaheadTouchSourceWithSuggestions','Parent','React','ReactDOM','Stratcom','SubscriptionsHandler','TypeaheadCompositeSource','URI','Vector','csx','cx'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){'use strict';var da,ea,fa=u.PropTypes,ga=10;da=babelHelpers.inherits(ha,u.Component);ea=da&&da.prototype;function ha(){var ja,ka;for(var la=arguments.length,ma=Array(la),na=0;na<la;na++)ma[na]=arguments[na];return ka=(ja=ea.constructor).call.apply(ja,[this].concat(ma)),ia.call(this),ka;}ha.prototype.shouldComponentUpdate=function(ja,ka){if(this.state.resultData!==ka.resultData||this.state.waiting!==ka.waiting)return true;var la=ja.excludedEntries,ma=this.props.excludedEntries;for(var na in la)if(la[na]!==ma[na])return true;for(var oa in ma)if(ma[oa]!==la[oa])return true;if(this.props.configureDataSourceOnNewProps&&this.props.maxSuggestionCount!==ja.maxSuggestionCount)return true;return false;};ha.prototype.componentDidMount=function(){this.refs.input.type="search";if(this.props.configureDataSourceOnNewProps)this.configureDatasource();if(this.props.focusOnMount)this.focusInput();if(this.props.initialInputValue)this.setInputValue(this.props.initialInputValue);};ha.prototype.componentWillUpdate=function(){this.$MReactTypeahead5('render_start');};ha.prototype.componentDidUpdate=function(ja,ka){this.props.onUpdate&&this.props.onUpdate();if(this.props.configureDataSourceOnNewProps&&this.props.maxSuggestionCount!==ja.maxSuggestionCount){this.setDatasource(null);this.configureDatasource();this.query(this.state.query,true);}this.$MReactTypeahead5('rendered');};ha.prototype.render=function(){var ja=this.props.showClearButton&&this.state.query,ka=this.props.typeaheadRootClassName||"_5fn4",la=u.createElement('input',{type:'search',ref:'input',className:'input',autoCorrect:'off',autoComplete:'off',autoCapitalize:'off',name:'query',placeholder:this.props.placeholder,onBlur:this.props.onBlur,onKeyUp:this.onKeyUp,onKeyDown:this.props.onKeyDown,onFocus:this.$MReactTypeahead8,onChange:this.inputChanged});if(this.props.typeaheadConfig.submitOnEnter)la=u.createElement('form',{ref:'searchForm',action:'/search',className:"_4e7a",onSubmit:this.onSearchFormSubmit},la,u.createElement('input',{type:'hidden',name:'source',value:'typeahead'}));var ma="_5fn6 touchable";if(this.props.useStandardClearButton)ma="_5fn6 touchable mClearButton";var na=this.props.hideSelected?this.$MReactTypeahead6(this.state.resultData):this.state.resultData;return u.createElement('div',{className:this.props.className},u.createElement('div',{className:ka},u.createElement('div',{className:"_5fn5"},la,u.createElement('div',{className:ma,'data-sigil':'touchable',style:{display:ja?'':'none'},onMouseDown:this.onClearButtonEvent,onTouchStart:this.onClearButtonEvent},u.createElement('div',null,'\u00D7')))),u.createElement(k,{ref:'results',Renderer:this.props.presenter.ViewRenderer,data:na,excludedEntries:this.props.excludedEntries,query:this.state.query,waiting:this.state.waiting,loaderMarkup:this.props.typeaheadConfig.loaderMarkup,onTouchStart:this.props.onTouchStart,simpleSearch:this.props.simpleSearch,onClickItem:this.$MReactTypeahead9,maxSuggestionCount:this.props.maxSuggestionCount}));};ha.prototype.$MReactTypeahead11=function(){if(!this.$MReactTypeahead4)this.$MReactTypeahead4=new x();return this.$MReactTypeahead4;};ha.prototype.cleanup=function(){this.$MReactTypeahead10(null);this.$MReactTypeahead4&&this.$MReactTypeahead4.release();};ha.prototype.componentWillUnmount=function(){this.cleanup();};ha.propTypes={onClickItem:fa.func,onBlur:fa.func,onKeyUp:fa.func,onKeyDown:fa.func,onTouchStart:fa.func,placeholder:fa.string,presenter:fa.object.isRequired,showClearButton:fa.bool,typeaheadConfig:fa.object.isRequired,excludedEntries:fa.object,getTypeaheadOnDemandSource:fa.func,getTypeaheadTouchSource:fa.func,getTypeaheadCompositeSource:fa.func,getTypeaheadNullstateSource:fa.func,onFocus:fa.func,simpleSearch:fa.bool,suggestions:fa.array,hideSelected:fa.bool,maxSuggestionCount:fa.number,configureDataSourceOnNewProps:fa.bool,setAllSourceMaxCount:fa.bool,setNullstateData:fa.array,focusOnMount:fa.bool,initialInputValue:fa.string,showSelectedInput:fa.bool};var ia=function ja(){this.state={resultData:[],query:null,waiting:false};this.$MReactTypeahead1=null;this.$MReactTypeahead3=null;this.listen=function(ka,la){this.$MReactTypeahead3=this.$MReactTypeahead3||new i();return this.$MReactTypeahead3.addListener(ka,la.bind(this));}.bind(this);this.$MReactTypeahead5=function(ka,la){this.$MReactTypeahead3&&this.$MReactTypeahead3.emit.apply(this.$MReactTypeahead3,[ka].concat(la));}.bind(this);this.waitForResults=function(){this.setState({waiting:true});}.bind(this);this.showResults=function(ka){if(this.props.setNullstateData!=null&&v.findDOMNode(this.refs.input).value==='')ka=this.props.setNullstateData;if(this.props.hideSelected)ka=this.$MReactTypeahead6(ka);ka.forEach(function(la){la.uri=new z(la.uri).addQueryData('refid',m.refid);return la;});this.setState({resultData:ka,waiting:true},this.$MReactTypeahead7);this.$MReactTypeahead5('show',[ka]);}.bind(this);this.$MReactTypeahead6=function(ka){var la=this.props.excludedEntries;if(la)return ka.filter(function(ma){return !la[ma.id];});return ka;}.bind(this);this.$MReactTypeahead7=function(){if(this.state.query==null)this.setState({waiting:false});}.bind(this);this.complete=function(){this.setState({waiting:false});}.bind(this);this.reset=function(){v.findDOMNode(this.refs.input).value='';this.query('',true);}.bind(this);this.query=function(ka,la){la=la||false;if(la||this.state.query!==ka){this.$MReactTypeahead5('update',[ka]);this.$MReactTypeahead5('change',[ka]);this.setState({query:ka});}}.bind(this);this.inputChanged=function(){if(v.findDOMNode(this.refs.input).value==='')this.query('');}.bind(this);this.onSearchFormSubmit=function(event){event.preventDefault();var ka=v.findDOMNode(this.refs.input),la=ka.value;this.$MReactTypeahead5('query',[this.state.resultData]);var ma=new z('/search/?query').addQueryData('query',la).toString();j.load(ma);}.bind(this);this.setInputValue=function(ka){if(ka)v.findDOMNode(this.refs.input).value=ka;}.bind(this);this.onKeyUp=function(event){var ka=this.getInputValue();this.query(ka);this.props.onKeyUp&&this.props.onKeyUp(event);}.bind(this);this.onClearButtonEvent=function(event){event.preventDefault();this.reset();this.focusInput();}.bind(this);this.getInputValue=function(){return v.findDOMNode(this.refs.input).value;}.bind(this);this.getInputNode=function(){return v.findDOMNode(this.refs.input);}.bind(this);this.getValue=function(){return this.getInputValue();}.bind(this);this.focusInput=function(){v.findDOMNode(this.refs.input).focus();}.bind(this);this.blurInput=function(){v.findDOMNode(this.refs.input).blur();}.bind(this);this.$MReactTypeahead9=function(event,ka,la){this.reset();this.props.onClickItem&&this.props.onClickItem(event,ka,la);if(this.props.showSelectedInput&&ka.name)this.setInputValue(ka.name);this.$MReactTypeahead5('select',[t.bySelector(event.target,"._5fna")]);this.$MReactTypeahead5('result-selected',[ka]);this.forceUpdate();}.bind(this);this.getDisplayedHeight=function(){var ka=v.findDOMNode(this.refs.results),la=aa.getPos(ka).y;return aa.getDim(ka).y+la;}.bind(this);this.getDatasource=function(){return this.$MReactTypeahead1;}.bind(this);this.$MReactTypeahead10=function(ka){if(this.$MReactTypeahead1)this.$MReactTypeahead1.unbindFromTypeahead(this);if(this.$MReactTypeahead2){this.$MReactTypeahead2.release();delete this.$MReactTypeahead2;}this.$MReactTypeahead1=ka;if(!this.$MReactTypeahead1)return;this.$MReactTypeahead2=new x();this.$MReactTypeahead2.addSubscriptions(ka.listen('waiting',this.waitForResults),ka.listen('resultsready',this.showResults),ka.listen('complete',this.complete));ka.bindToTypeahead(this);}.bind(this);this.configureDatasource=function(ka){if(this.$MReactTypeahead1)return;var la=this.props.typeaheadConfig.sources,ma=[],na=new z(la.bootstrapped.src);if(this.props.includeFamilyTags){var oa=na.getQueryData();oa.filter.push('family_tags');na.setQueryData(oa);}var pa=this.getTypeaheadTouchSource(na.toString(),la.bootstrapped.source_key,this.props.suggestions);pa.setShowSecondaryAction(true);pa.clientRendered=true;this.touchSource=pa;ma.push(pa);if(la.nullstate){this.nullstateDataSource=this.getTypeaheadNullstateSource(la.nullstate.src);this.nullstateDataSource.setMaximumResultCount(la.nullstate.max_results);this.nullstateDataSource.setShowSecondaryAction(true);this.nullstateDataSource.clientRendered=true;ma.push(this.nullstateDataSource);}pa=this.getTypeaheadOnDemandSource(la.online.src);pa.setMaximumResultCount(la.online.max_results);pa.setEnableImmediateReturnOfCachedResults(la.online.enable_caching);if(ka){if(ka.enableQueryThrottle)pa.setThrottleSendRequest(ka.queryThrottleTime);pa.setMaxResults(ka.maxResults);pa.setEnableEagerSendRequest(ka.enableEagerSendRequest);pa.setQueryDelay(ka.queryWaitTime);}pa.setShowSecondaryAction(true);pa.clientRendered=true;ma.push(pa);if(this.props.setAllSourceMaxCount)for(var qa=ma,ra=Array.isArray(qa),sa=0,qa=ra?qa:qa[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var ta;if(ra){if(sa>=qa.length)break;ta=qa[sa++];}else{sa=qa.next();if(sa.done)break;ta=sa.value;}var ua=ta;ua.setMaximumResultCount(this.props.maxSuggestionCount);}var va=this.getTypeaheadCompositeSource(ma);if(this.props.typeaheadConfig.excludeids)this.props.typeaheadConfig.excludeids.forEach(function(wa){va.addExcludeID(wa);});va.clientRendered=true;va.mergeKey='id';this.$MReactTypeahead10(va);this.$MReactTypeahead5('start');}.bind(this);this.configureMSideNavMarauderLogger=function(){if(!this.props.typeaheadConfig.mSideNavMarauderLogger||this.$MReactTypeahead12)return;this.props.typeaheadConfig.mSideNavMarauderLogger.setupTypeaheadListener(this);this.$MReactTypeahead12=true;}.bind(this);this.configureMRecentSearchesUpdater=function(){if(this.props.typeaheadConfig.hasRecentSearches){var ka=new l(this);this.$MReactTypeahead11().addSubscriptions({remove:ka.destroy});}}.bind(this);this.configureMSearchTypeaheadLogger=function(){if(this.$MReactTypeahead13)return;this.$MReactTypeahead11().addSubscriptions(w.listen('m-typeahead-logger:new-session-id',null,this.addSessionIDToSearch));var ka='/search/metrics.php',la=new n(this,ka);this.$MReactTypeahead13=true;this.$MReactTypeahead11().addSubscriptions(w.listen('log-m-search-session-end',null,function(ma){la.blur(ma.getData().reason);}));}.bind(this);this.configureMSearchTypeaheadPerfLogger=function(){if(!this.props.typeaheadConfig.typeaheadScubaInfo||this.$MReactTypeahead14)return;var ka=o.getNewMSearchTypeaheadPerfLogger(this,this.props.typeaheadConfig.typeaheadScubaInfo,this.props.typeaheadConfig.sources.online.enable_caching);this.$MReactTypeahead11().addSubscriptions({remove:ka.destroy});this.$MReactTypeahead14=true;}.bind(this);this.addSessionIDToSearch=function(ka){if(!this.refs||!this.refs.searchForm)return;var la=v.findDOMNode(this.refs.searchForm),ma=h.scry(la,'input','search-typeahead-session-id')[0];if(!ma){ma=document.createElement('input');ma.type='hidden';ma.name='tsid';la.appendChild(ma);w.addSigil(ma,'search-typeahead-session-id');}ma.value=ka.getData().sessionID;}.bind(this);this.getTypeaheadCompositeSource=function(ka){if(this.props.getTypeaheadCompositeSource)return this.props.getTypeaheadCompositeSource(ka);return new y(ka);}.bind(this);this.getTypeaheadOnDemandSource=function(ka){if(this.props.getTypeaheadOnDemandSource)return this.props.getTypeaheadOnDemandSource(ka);return new q(ka);}.bind(this);this.getTypeaheadTouchSource=function(ka,la,ma){if(this.props.getTypeaheadTouchSource)return this.props.getTypeaheadTouchSource(ka,la);if(ma){var na=new s(ka,la,ma);if(this.props.maxSuggestionCount){na.setMaximumResultCount(this.props.maxSuggestionCount);}else na.setMaximumResultCount(ga);return na;}return new r(ka,la);}.bind(this);this.getTypeaheadNullstateSource=function(ka){if(this.props.getTypeaheadNullstateSource)return this.props.getTypeaheadNullstateSource(ka);return new p(ka);}.bind(this);this.getTypeaheadType=function(){var ka='m_side_nav';if(this.props.simpleSearch){ka+='_simple';}else ka+='_gsv2';return ka;}.bind(this);this.updateSuggestionsIds=function(ka){if(this.touchSource)this.touchSource.setSuggestionsIds(ka);if(v.findDOMNode(this.refs.input).value==='')this.reset();}.bind(this);this.$MReactTypeahead8=function(){this.props.onFocus&&this.props.onFocus();this.query(this.getInputValue());}.bind(this);};f.exports=ha;}),null);
__d('MTaggerResultsRow.react',['React','cx','MXUILayout.react','MXUIDiv.react','MXUILayoutColumn.react','MXUILayoutFillColumn.react'],(function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';var n,o,p=h.PropTypes;n=babelHelpers.inherits(q,h.Component);o=n&&n.prototype;function q(){var r,s;for(var t=arguments.length,u=Array(t),v=0;v<t;v++)u[v]=arguments[v];return s=(r=o.constructor).call.apply(r,[this].concat(u)),this.state={checked:false},this.$MTaggerResultsRow1=function(){return h.createElement('div',{className:"_5rmb",style:{backgroundImage:'url('+this.props.data.photo+')'}});}.bind(this),this.$MTaggerResultsRow2=function(){var w=this.props.data,x=w.subtext;if(!x)return null;return h.createElement('span',{className:"_5rmc"},x);}.bind(this),this.$MTaggerResultsRow3=function(event){this.setState({checked:!this.state.checked});this.props.onClickItem&&this.props.onClickItem(event,this.props.data,this.props.checked);}.bind(this),s;}q.prototype.render=function(){var r=this.props.data,s=this.props.checked?"_5tbv":'';return h.createElement(k,{'aria-checked':this.state.checked,className:"_5rmd",onClick:this.$MTaggerResultsRow3,role:'checkbox'},h.createElement(j,null,h.createElement(l,{key:'profile_image'},this.$MTaggerResultsRow1()),h.createElement(m,{alignself:'center',className:"_5rme",key:'display_name'},h.createElement('div',null,h.createElement('div',{className:"_5rmf"},r.display||r.name),this.$MTaggerResultsRow2())),h.createElement(l,{key:'check_mark'},h.createElement('div',{className:"_5tbx"},h.createElement('div',{className:s})))));};q.propTypes={data:p.object,onClickItem:p.func};f.exports=q;}),null);
__d('MTaggerTypeaheadPresenter.react',['MTaggerResultsRow.react','React','cx'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l,m=i.PropTypes,n=30;k=babelHelpers.inherits(o,i.Component);l=k&&k.prototype;o.prototype.render=function(){var q=this.props.data.slice(0,n).map(function(r){var s=false;if(this.props.excludedEntries)s=!!this.props.excludedEntries[r.id];return i.createElement(h,{key:r.id,data:r,onClickItem:this.props.onClickItem,checked:s});},this);return i.createElement('div',{className:"_53na",onTouchStart:this.props.onTouchStart},q);};function o(){k.apply(this,arguments);}o.propTypes={query:m.string,data:m.array,onClickItem:m.func,onTouchStart:m.func,excludedEntries:m.object};var p={ViewRenderer:o};f.exports=p;}),null);
__d("TokenCollection",[],(function a(b,c,d,e,f,g){function h(){"use strict";this.entries=[];}h.prototype.addEntry=function(i){"use strict";if(!this.hasEntry(i))this.entries.push(i);return this;};h.prototype.removeEntry=function(i){"use strict";if(this.hasEntry(i)){var j=0;while(j<this.entries.length){if(this.entries[j].id===i.id)break;j++;}this.entries.splice(j,1);}return this;};h.prototype.hasEntry=function(i){"use strict";var j=i.id;return this.entries.some(function(k){return k.id===j;});};h.prototype.shallowClone=function(){"use strict";var i=new h();i.entries=this.entries.slice(0);return i;};f.exports=h;}),null);
__d('MTokenizer.react',['React','ReactComponentRenderer','MReactTypeahead','MTaggerTypeaheadPresenter.react','MTokenCollection.react','MTokenRenderer.react','TokenCollection','MViewport','Vector','Keys','MLegacyDataStore','cx','fbt','joinClasses'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v,w,x=h.PropTypes;v=babelHelpers.inherits(y,h.Component);w=v&&v.prototype;function y(){var z,aa;'use strict';for(var ba=arguments.length,ca=Array(ba),da=0;da<ba;da++)ca[da]=arguments[da];return aa=(z=w.constructor).call.apply(z,[this].concat(ca)),this.state={focus:false},this.init=function(){this.initWithoutFocus();this.refs.typeahead.focusInput();}.bind(this),this.initWithoutFocus=function(){this.refs.typeahead.configureDatasource();this.forceUpdate();this.refs.typeahead.reset();}.bind(this),this.cleanup=function(){this.refs.typeahead.cleanup();}.bind(this),this.updateTypeahead=function(){this.forceUpdate();}.bind(this),this.onRemoveFromCollection=function(ea){this.$MTokenizer1.removeEntry(ea);this.props.onRemove&&this.props.onRemove(ea);this.forceUpdate();}.bind(this),this.$MTokenizer3=function(ea){if(!this.state.focus){ea.preventDefault();this.refs.typeahead.focusInput();this.setState({focus:true});}}.bind(this),this.$MTokenizer7=function(){if(this.$MTokenizer2===null)this.$MTokenizer2=o.getScrollTop();}.bind(this),this.$MTokenizer8=function(){if(this.$MTokenizer2!==null)o.scrollTo(0,this.$MTokenizer2);this.$MTokenizer2=null;}.bind(this),this.$MTokenizer5=function(event){if(this.props.scrollToTypeahead){this.$MTokenizer7();var ea=this.refs.typeahead.getInputNode(),fa=p.getPos(ea).y;o.scrollTo(0,fa);}if(event.nativeEvent.keyCode===q.BACKSPACE)this.$MTokenizer9();}.bind(this),this.$MTokenizer4=function(){if(this.props.scrollToTypeahead)this.$MTokenizer8();this.props.onInputBlur&&this.props.onInputBlur();if(this.state.focus)this.setState({focus:false});}.bind(this),this.$MTokenizer6=function(event,ea,fa){if(fa){this.onRemoveFromCollection(ea);}else{this.$MTokenizer1.addEntry(ea);this.props.onAdd&&this.props.onAdd(ea);}if(this.props.hideSelected)setTimeout(function(){this.refs.typeahead.focusInput();}.bind(this),0);event.stopPropagation();this.forceUpdate();}.bind(this),this.getEntries=function(){return this.$MTokenizer1.entries;}.bind(this),this.setEntries=function(ea){this.$MTokenizer1.entries=ea;}.bind(this),this.$MTokenizer9=function(){var ea=this.getEntries();if(ea&&ea.length&&!this.refs.typeahead.getInputValue())this.$MTokenizer1.removeEntry(ea[ea.length-1]);this.forceUpdate();}.bind(this),this.updateSuggestionsIds=function(ea){this.init();this.updateTypeaheadWithSuggestions(ea);}.bind(this),this.updateTypeaheadWithSuggestions=function(ea){this.refs.typeahead.updateSuggestionsIds(ea);}.bind(this),this.focusAndUpdateSuggestionsIDs=function(ea){this.refs.typeahead.updateSuggestionsIds(ea);this.refs.typeahead.focusInput();}.bind(this),aa;}y.prototype.componentWillMount=function(){'use strict';this.$MTokenizer1=new n();this.$MTokenizer2=null;};y.prototype.componentWillUnmount=function(){'use strict';this.cleanup();};y.prototype.render=function(){'use strict';var z=this.$MTokenizer1.entries||[],aa={},ba=z&&z.length>0;if(ba)for(var ca=0;ca<z.length;++ca)aa[z[ca].id]=true;if(this.props.excludedEntries)for(var da in this.props.excludedEntries)aa[da]=this.props.excludedEntries[da];var ea=ba?null:this.props.placeholder;return h.createElement('div',babelHelpers['extends']({},this.props,{className:u(this.props.className,"_5snt"),onClick:this.$MTokenizer3,role:'presentation'}),h.createElement(l,{ref:'collection',collection:this.$MTokenizer1,collectionKey:this.props.collectionKey,renderer:m,onRemove:this.onRemoveFromCollection}),h.createElement(j,{ref:'typeahead',className:"_5snu",typeaheadRootClassName:"_5snv",excludedEntries:aa,placeholder:ea,presenter:this.props.presenter,typeaheadConfig:this.props.typeaheadConfig,includeFamilyTags:this.props.includeFamilyTags,onBlur:this.$MTokenizer4,onKeyDown:this.$MTokenizer5,onClickItem:this.$MTokenizer6,suggestions:this.props.suggestions,hideSelected:this.props.hideSelected,maxSuggestionCount:this.props.maxSuggestionCount}));};y.propTypes={placeholder:x.string,typeaheadConfig:x.object.isRequired,presenter:x.object.isRequired,excludedEntries:x.object,collectionKey:x.string,onInputBlur:x.func,includeFamilyTags:x.bool,hideSelected:x.bool,onAdd:x.func,onRemove:x.func,maxSuggestionCount:x.number,scrollToTypeahead:x.bool};y.init=function(z){var aa=t._("Start typing a name..."),ba=r.get(z.container);ba.tokenizer=new i(y,z.container);ba.tokenizer.setProps({placeholder:aa,presenter:k,typeaheadConfig:z.typeaheadConfig,suggestions:z.suggestions,hideSelected:z.hideselected,collectionKey:z.collectionKey});ba.tokenizer.component.init();};f.exports=y;}),null);
__d('MStructuredComposerTaggingInputReact',['React'],(function a(b,c,d,e,f,g,h){var i,j,k="xy_tags",l='failed_suggestions';i=babelHelpers.inherits(m,h.Component);j=i&&i.prototype;function m(){var n,o;'use strict';for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=j.constructor).call.apply(n,[this].concat(q)),this.$MStructuredComposerTaggingInputReact1=function(s,t,u,v){var w=k+"["+v+"]";return h.createElement('div',{key:"tag"+s.fbid},h.createElement('input',{type:'hidden',name:w+"[x]",value:s.x}),h.createElement('input',{type:'hidden',name:w+"[y]",value:s.y}),h.createElement('input',{type:'hidden',name:w+"[fbid]",value:s.photoID}),h.createElement('input',{type:'hidden',name:w+"[name]",value:u}),h.createElement('input',{type:'hidden',name:w+"[subject]",value:t}),h.createElement('input',{type:'hidden',name:w+"[facebox]",value:s.fbid}),h.createElement('input',{type:'hidden',name:w+"[source]",value:'photos_touch_composer'}));},this.$MStructuredComposerTaggingInputReact2=function(){var s=this.props.tokenCollection,t=this.props.tagSuggestions,u=[],v=0;s.map(function(w){var x=t[w.id];if(x)u=u.concat(Object.keys(x).map(function(y){var z=this.$MStructuredComposerTaggingInputReact1(x[y],w.id,w.name,v);v++;return z;}.bind(this)));}.bind(this));return u;}.bind(this),this.$MStructuredComposerTaggingInputReact3=function(s,t){var u=l+"["+t+"]";return h.createElement('div',{key:"failed"+s.fbid},h.createElement('input',{type:'hidden',name:u+"[fbid]",value:s.fbid}),h.createElement('input',{type:'hidden',name:u+"[tagee]",value:s.recognitions[0].user.fbid}));},o;}m.prototype.render=function(){'use strict';return h.createElement('div',null,this.$MStructuredComposerTaggingInputReact2(),this.props.failedSuggestions.map(this.$MStructuredComposerTaggingInputReact3));};f.exports=m;}),null);
__d("XPhotosGetRecognitionController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/photos\/tagging\/recognition\/",{photos:{type:"IntVector"},recognition_project:{type:"String",defaultValue:"default"},include_unrecognized_faceboxes:{type:"Bool",defaultValue:false},is_page:{type:"Bool",defaultValue:false},target:{type:"Int"},include_face_crop_src:{type:"Bool",defaultValue:false},include_recognized_user_profile_picture:{type:"Bool",defaultValue:false},include_low_confidence_recognitions:{type:"Bool",defaultValue:false},face_crop_width:{type:"Int",defaultValue:32},face_crop_height:{type:"Int",defaultValue:32}});}),null);
__d('MTagSuggestionsPoller',['MRequest','XPhotosGetRecognitionController','PhotosUploadWaterfallXMixin','mixin','performanceNow','PUWSteps'],(function a(b,c,d,e,f,g,h,i,j,k,l,m){var n,o,p=4,q=2000,r=8000;n=babelHelpers.inherits(s,k(j));o=n&&n.prototype;function s(){'use strict';o.constructor.call(this);this.$MTagSuggestionsPoller1=q;this.$MTagSuggestionsPoller2=0;this.$MTagSuggestionsPoller3={};this.$MTagSuggestionsPoller4=false;this.$MTagSuggestionsPoller5=null;}s.prototype.setRecognitionProject=function(t){'use strict';this.$MTagSuggestionsPoller6=t;return this;};s.prototype.setIncludeUnrecognized=function(t){'use strict';this.$MTagSuggestionsPoller7=t;return this;};s.prototype.setTargetIsPage=function(t){'use strict';this.$MTagSuggestionsPoller8=t;return this;};s.prototype.setTargetId=function(t){'use strict';this.$MTagSuggestionsPoller9=t;return this;};s.prototype.setHandler=function(t){'use strict';this.$MTagSuggestionsPoller10=t;return this;};s.prototype.setTimeoutHandler=function(t){'use strict';this.$MTagSuggestionsPoller11=t;return this;};s.prototype.isPolling=function(){'use strict';return this.$MTagSuggestionsPoller4;};s.prototype.setWaterfall=function(t,u,v){'use strict';this.$MTagSuggestionsPoller12=t;this.$MTagSuggestionsPoller13=u;this.$MTagSuggestionsPoller14=v;return this;};s.prototype.addPhotoIDAndLog=function(t,u){'use strict';this.$MTagSuggestionsPoller3[t]=u;this.logStep(m.CLIENT_FACEREC_BEGIN,{fbid:t});this.invalidateTimeout();this.startMasterTimerIfNeeded();};s.prototype.removePhotoID=function(t){'use strict';delete this.$MTagSuggestionsPoller3[t];};s.prototype.hasPhotoID=function(t){'use strict';return Object.prototype.hasOwnProperty.call(this.$MTagSuggestionsPoller3,t);};s.prototype.$MTagSuggestionsPoller15=function(t){'use strict';return this.$MTagSuggestionsPoller3[t];};s.prototype.startMasterTimerIfNeeded=function(){'use strict';if(!this.$MTagSuggestionsPoller5){this.$MTagSuggestionsPoller16=l();this.$MTagSuggestionsPoller5=setTimeout(this.$MTagSuggestionsPoller17.bind(this),r);}};s.prototype.invalidateTimeout=function(){'use strict';this.$MTagSuggestionsPoller2=0;if(this.$MTagSuggestionsPoller5){clearTimeout(this.$MTagSuggestionsPoller5);this.$MTagSuggestionsPoller5=null;}};s.prototype.start=function(){'use strict';var t=this.$MTagSuggestionsPoller18();if(t.length>0){this.$MTagSuggestionsPoller4=true;this.$MTagSuggestionsPoller2++;this.startMasterTimerIfNeeded();var u=new h(this.$MTagSuggestionsPoller19(t));this.$MTagSuggestionsPoller20=u;u.listen('done',function(v){this.$MTagSuggestionsPoller21(v);}.bind(this));u.listen('error',function(v){this.$MTagSuggestionsPoller22(v);}.bind(this));u.setTimeout(r);u.send();}};s.prototype.$MTagSuggestionsPoller17=function(){'use strict';this.$MTagSuggestionsPoller11&&this.$MTagSuggestionsPoller11(this.$MTagSuggestionsPoller23());this.abort();};s.prototype.abort=function(){'use strict';this.$MTagSuggestionsPoller4=false;for(var t in this.$MTagSuggestionsPoller3)this.logStep(m.CLIENT_FACEREC_FAIL,{attempt_number:this.$MTagSuggestionsPoller2,elapsed_time:l()-this.$MTagSuggestionsPoller16,fbid:t});this.$MTagSuggestionsPoller3={};this.invalidateTimeout();if(this.$MTagSuggestionsPoller20){this.$MTagSuggestionsPoller20&&this.$MTagSuggestionsPoller20.abort();this.$MTagSuggestionsPoller20=null;}};s.prototype.$MTagSuggestionsPoller21=function(t){'use strict';if(t.payload){var u=t.payload.filter(function(v){var w=v.fbid,x=this.hasPhotoID(w);if(x){v.attachmentID=this.$MTagSuggestionsPoller15(w);this.removePhotoID(w);this.logStep(m.CLIENT_FACEREC_SUCCESS,{attempt_number:this.$MTagSuggestionsPoller2,elapsed_time:l()-this.$MTagSuggestionsPoller16,xy_tag_count:v.faceboxes.length,fbid:w});}return x;}.bind(this));if(u.length>0)this.$MTagSuggestionsPoller10(u);}this.restart();};s.prototype.$MTagSuggestionsPoller22=function(t){'use strict';this.restart();};s.prototype.restart=function(){'use strict';if(this.$MTagSuggestionsPoller2<p){setTimeout(this.start.bind(this),this.$MTagSuggestionsPoller1);}else this.$MTagSuggestionsPoller17();};s.prototype.$MTagSuggestionsPoller18=function(){'use strict';var t=[];for(var u in this.$MTagSuggestionsPoller3)t.push(u);return t;};s.prototype.$MTagSuggestionsPoller23=function(){'use strict';var t=[];for(var u in this.$MTagSuggestionsPoller3)t.push(this.$MTagSuggestionsPoller3[u]);return t;};s.prototype.$MTagSuggestionsPoller19=function(t){'use strict';var u=i.getURIBuilder().setIntVector('photos',t).setString('recognition_project',this.$MTagSuggestionsPoller6).setBool('include_unrecognized_faceboxes',this.$MTagSuggestionsPoller7).setBool('is_page',this.$MTagSuggestionsPoller8).setInt('target',this.$MTagSuggestionsPoller9).getURI();return u;};s.prototype.getWaterfallID=function(){'use strict';return this.$MTagSuggestionsPoller12;};s.prototype.getWaterfallAppName=function(){'use strict';return this.$MTagSuggestionsPoller13;};s.prototype.getWaterfallSource=function(){'use strict';return this.$MTagSuggestionsPoller14;};f.exports=s;}),null);
__d('MTagSuggestionsController',['MTagSuggestionsPoller','React','ReactDOM','MStructuredComposerTaggingInputReact','DOM','BanzaiODS'],(function a(b,c,d,e,f,g,h,i,j,k,l,m){var n='mtouch_composer_facerec_suggestions';function o(p,q,r,s,t,u){'use strict';this.$MTagSuggestionsController1=p;this.$MTagSuggestionsController1.setOnShow(this.onTokenizerInit.bind(this));this.$MTagSuggestionsController1.setOnClear(this.reset.bind(this));this.$MTagSuggestionsController2=q.getUploader();this.$MTagSuggestionsController3=t;this.$MTagSuggestionsController3.setOnEntriesChangedHandler(this.$MTagSuggestionsController4.bind(this));this.$MTagSuggestionsController5=0;this.$MTagSuggestionsController2.setProps({onUploadSuccess:this.onPhotoUploadSuccess.bind(this),onRemove:this.removeFaceboxesByPhotoID.bind(this)});this.$MTagSuggestionsController6=new h().setRecognitionProject('composer_facerec').setIncludeUnrecognized(true).setTargetIsPage(r==='page').setTargetId(s).setHandler(function(v){this.handleFaceboxResponse(v);}.bind(this)).setTimeoutHandler(function(v){this.onPollerTimeout(v);}.bind(this)).setWaterfall(this.$MTagSuggestionsController2.component.getWaterfallID(),this.$MTagSuggestionsController2.component.getWaterfallAppName(),this.$MTagSuggestionsController2.component.getWaterfallSource());this.$MTagSuggestionsController7={};this.$MTagSuggestionsController8={};this.$MTagSuggestionsController9={};this.$MTagSuggestionsController10=false;this.$MTagSuggestionsController11={};this.$MTagSuggestionsController12=!!u;}o.prototype.onTokenizerInit=function(){'use strict';if(Object.keys(this.$MTagSuggestionsController9).length>0)this.updateTypeaheadWithFaceboxSuggestions();if(!this.$MTagSuggestionsController10){this.$MTagSuggestionsController10=true;this.$MTagSuggestionsController1.getTokenizer().setProps({onAdd:this.$MTagSuggestionsController13.bind(this),onRemove:this.$MTagSuggestionsController14.bind(this)});}};o.prototype.$MTagSuggestionsController13=function(p){'use strict';this.$MTagSuggestionsController11[p.id]=true;};o.prototype.$MTagSuggestionsController14=function(p){'use strict';delete this.$MTagSuggestionsController11[p.id];if(p.autoTag)m.bumpEntityKey(n,'remove_auto_tag');};o.prototype.$MTagSuggestionsController15=function(p){'use strict';var q={};p.forEach(function(w){q[w.id]=true;});for(var r in this.$MTagSuggestionsController7)for(var s in this.$MTagSuggestionsController7[r]){var t=this.$MTagSuggestionsController7[r][s];if(!t.tagUserID){if(!t.ignoreRecognition){var u=t.recognitions[0].user.fbid,v=t.recognitions[0].user.name;if(q[u]){t.tagUserID=u;t.tagName=v;}}}else if(!q[t.tagUserID]){if(this.$MTagSuggestionsController8[t.tagUserID]&&t.ignoreRecognition)delete this.$MTagSuggestionsController8[t.tagUserID][s];delete t.tagUserID;delete t.tagName;}}};o.prototype.$MTagSuggestionsController4=function(p){'use strict';this.$MTagSuggestionsController15(p);this.$MTagSuggestionsController16(p);};o.prototype.$MTagSuggestionsController16=function(p){'use strict';var q={};p.forEach(function(r){var s=this.$MTagSuggestionsController8[r.id];for(var t in s){var u=s[t].attachmentID;if(!q[u])q[u]=0;q[u]++;}}.bind(this));this.$MTagSuggestionsController2.component.setAttachmentTagCounts(q);};o.prototype.onPhotoUploadSuccess=function(p,q){'use strict';this.$MTagSuggestionsController6.addPhotoIDAndLog(p,q);this.$MTagSuggestionsController2.component.setAttachmentProps(q,{isPollingTagSuggestions:true});if(!this.$MTagSuggestionsController6.isPolling())this.$MTagSuggestionsController6.start();};o.prototype.$MTagSuggestionsController17=function(p){'use strict';return {name:p.tagName,display:p.tagName,id:p.tagUserID,autoTag:true};};o.prototype.handleFaceboxResponse=function(p){'use strict';p.forEach(function(r){var s=r.fbid,t=r.faceboxes;this.$MTagSuggestionsController2.component.setAttachmentProps(r.attachmentID,{isPollingTagSuggestions:false});t.forEach(function(u){u.photoID=s;u.attachmentID=r.attachmentID;if(!this.$MTagSuggestionsController7[s])this.$MTagSuggestionsController7[s]={};this.$MTagSuggestionsController7[s][u.fbid]=u;if(u.recognitions.length>0){u.ignoreRecognition=false;var v=u.recognitions[0].user.fbid;if(!this.$MTagSuggestionsController8[v])this.$MTagSuggestionsController8[v]={};this.$MTagSuggestionsController8[v][u.fbid]=u;if(!this.$MTagSuggestionsController9[v])this.$MTagSuggestionsController9[v]=0;this.$MTagSuggestionsController9[v]++;if(!this.$MTagSuggestionsController10&&this.$MTagSuggestionsController12){u.tagName=u.recognitions[0].user.name;u.tagUserID=v;var w=this.$MTagSuggestionsController17(u);this.$MTagSuggestionsController3.addAutoToken(w);}}else u.ignoreRecognition=true;}.bind(this));}.bind(this));var q=this.$MTagSuggestionsController3.getEntries();this.$MTagSuggestionsController15(q);this.$MTagSuggestionsController16(q);};o.prototype.removeFaceboxesByPhotoID=function(p){'use strict';if(this.$MTagSuggestionsController6.hasPhotoID(p)){this.$MTagSuggestionsController6.removePhotoID(p);}else if(this.$MTagSuggestionsController7[p]){var q=this.$MTagSuggestionsController7[p];for(var r in q){var s=q[r];if(s.recognitions.length>0)this.$MTagSuggestionsController18(s);}this.$MTagSuggestionsController7[p]=null;}};o.prototype.$MTagSuggestionsController18=function(p){'use strict';var q=p.tagUserID||p.recognitions[0].user.fbid;if(p.recognitions.length>0){this.$MTagSuggestionsController9[q]--;if(this.$MTagSuggestionsController9[q]===0)delete this.$MTagSuggestionsController9[q];}if(this.$MTagSuggestionsController8[q]){delete this.$MTagSuggestionsController8[q][p.fbid];if(Object.keys(this.$MTagSuggestionsController8[q]).length<=0&&!this.$MTagSuggestionsController11[q]&&this.$MTagSuggestionsController12){var r=this.$MTagSuggestionsController17(p);this.$MTagSuggestionsController3.onRemove(r);}else this.$MTagSuggestionsController16(this.$MTagSuggestionsController3.getEntries());}};o.prototype.updateTypeaheadWithFaceboxSuggestions=function(){'use strict';var p=Object.keys(this.$MTagSuggestionsController9);p=p.map(function(s){return +s;});var q=this.$MTagSuggestionsController1.getTokenizer(),r=q.component.props.suggestions.map(function(s){return s.uid;});r.forEach(function(s){if(p.indexOf(s)<0)p.push(s);});q.updateTypeaheadWithSuggestions(p);};o.prototype.$MTagSuggestionsController19=function(){'use strict';var p=this.$MTagSuggestionsController1.getTokenizer();p.component.updateTypeaheadWithSuggestions([]);};o.prototype.generateHiddenInput=function(p){'use strict';var q=[];for(var r in this.$MTagSuggestionsController7)for(var s in this.$MTagSuggestionsController7[r]){var t=this.$MTagSuggestionsController7[r][s];if(t.recognitions.length>0&&t.ignoreRecognition&&t.tagUserID!==t.recognitions[0].user.fbid)q.push(t);}var u=l.create('div',{});l.appendContent(p,u);j.render(i.createElement(k,{tokenCollection:this.$MTagSuggestionsController3.getEntries(),tagSuggestions:this.$MTagSuggestionsController8,failedSuggestions:q}),u);};o.prototype.onPollerTimeout=function(p){'use strict';p.forEach(function(q){this.$MTagSuggestionsController2.component.setAttachmentProps(q,{isPollingTagSuggestions:false});}.bind(this));};o.prototype.addXYTag=function(p){'use strict';var q=this.$MTagSuggestionsController7[p.photoID][p.fbid];if(q.recognitions.length>0)this.$MTagSuggestionsController18(q);o.addFaceboxData(q,p.tagName,p.tagUserID);if(!this.$MTagSuggestionsController8[q.tagUserID])this.$MTagSuggestionsController8[q.tagUserID]={};this.$MTagSuggestionsController8[q.tagUserID][q.fbid]=q;var r=this.$MTagSuggestionsController17(q);this.$MTagSuggestionsController3.addManualXYTag(r);this.$MTagSuggestionsController5+=1;};o.prototype.deleteXYTag=function(p){'use strict';var q=this.$MTagSuggestionsController7[p.photoID][p.fbid];q.ignoreRecognition=true;delete q.tagUserID;delete q.tagName;this.$MTagSuggestionsController18(p);this.$MTagSuggestionsController5-=1;};o.prototype.getNumXYTags=function(){'use strict';return this.$MTagSuggestionsController5;};o.prototype.getFaceboxesCopyForPhoto=function(p){'use strict';var q={};for(var r in this.$MTagSuggestionsController7[p])q[r]=babelHelpers['extends']({},this.$MTagSuggestionsController7[p][r]);return q;};o.prototype.reset=function(){'use strict';this.$MTagSuggestionsController6.abort();this.$MTagSuggestionsController9={};this.$MTagSuggestionsController7={};this.$MTagSuggestionsController8={};this.$MTagSuggestionsController19();this.$MTagSuggestionsController10=false;this.$MTagSuggestionsController11={};this.$MTagSuggestionsController5=0;};o.addFaceboxData=function(p,q,r){'use strict';p.tagName=q;p.tagUserID=r;p.ignoreRecognition=true;};o.deleteFaceboxData=function(p){'use strict';delete p.tagUserID;delete p.tagName;p.ignoreRecognition=true;};f.exports=o;}),null);
__d('areEqual',[],(function a(b,c,d,e,f,g){var h=[],i=[];function j(l,m){var n=h.length?h.pop():[],o=i.length?i.pop():[],p=k(l,m,n,o);n.length=0;o.length=0;h.push(n);i.push(o);return p;}function k(l,m,n,o){if(l===m)return l!==0||1/l==1/m;if(l==null||m==null)return false;if(typeof l!='object'||typeof m!='object')return false;var p=Object.prototype.toString,q=p.call(l);if(q!=p.call(m))return false;switch(q){case '[object String]':return l==String(m);case '[object Number]':return isNaN(l)||isNaN(m)?false:l==Number(m);case '[object Date]':case '[object Boolean]':return +l==+m;case '[object RegExp]':return l.source==m.source&&l.global==m.global&&l.multiline==m.multiline&&l.ignoreCase==m.ignoreCase;}var r=n.length;while(r--)if(n[r]==l)return o[r]==m;n.push(l);o.push(m);var s=0;if(q==='[object Array]'){s=l.length;if(s!==m.length)return false;while(s--)if(!k(l[s],m[s],n,o))return false;}else{if(l.constructor!==m.constructor)return false;if(Object.prototype.hasOwnProperty.call(l,'valueOf')&&Object.prototype.hasOwnProperty.call(m,'valueOf'))return l.valueOf()==m.valueOf();var t=Object.keys(l);if(t.length!=Object.keys(m).length)return false;for(var u=0;u<t.length;u++){if(t[u]==='_owner')continue;if(!Object.prototype.hasOwnProperty.call(m,t[u])||!k(l[t[u]],m[t[u]],n,o))return false;}}n.pop();o.pop();return true;}f.exports=j;}),null);